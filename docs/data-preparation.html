<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Data Preparation | DoD cloud2trees Demonstration: Forest Fuel Quantification for Wildfire Modeling using QUIC-Fire</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Data Preparation | DoD cloud2trees Demonstration: Forest Fuel Quantification for Wildfire Modeling using QUIC-Fire" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Data Preparation | DoD cloud2trees Demonstration: Forest Fuel Quantification for Wildfire Modeling using QUIC-Fire" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="sycan-marsh-or.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-preparation.html"><a href="data-preparation.html"><i class="fa fa-check"></i><b>2</b> Data Preparation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-preparation.html"><a href="data-preparation.html#study-sites"><i class="fa fa-check"></i><b>2.1</b> Study Sites</a></li>
<li class="chapter" data-level="2.2" data-path="data-preparation.html"><a href="data-preparation.html#point-cloud-data"><i class="fa fa-check"></i><b>2.2</b> Point Cloud Data</a></li>
<li class="chapter" data-level="2.3" data-path="data-preparation.html"><a href="data-preparation.html#itd-window-functions"><i class="fa fa-check"></i><b>2.3</b> ITD window functions</a></li>
<li class="chapter" data-level="2.4" data-path="data-preparation.html"><a href="data-preparation.html#other-plotting-functions"><i class="fa fa-check"></i><b>2.4</b> Other plotting functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html"><i class="fa fa-check"></i><b>3</b> Sycan Marsh (OR)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html#als-processing"><i class="fa fa-check"></i><b>3.1</b> ALS Processing</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html#itd-tuning"><i class="fa fa-check"></i><b>3.1.1</b> ITD tuning</a></li>
<li class="chapter" data-level="3.1.2" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html#cloud2trees-point-cloud-processing"><i class="fa fa-check"></i><b>3.1.2</b> <code>cloud2trees</code> point cloud processing</a></li>
<li class="chapter" data-level="3.1.3" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html#cloud2trees-results"><i class="fa fa-check"></i><b>3.1.3</b> <code>cloud2trees</code> Results</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html#uas-lidar-processing"><i class="fa fa-check"></i><b>3.2</b> UAS lidar Processing</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html#itd-tuning-1"><i class="fa fa-check"></i><b>3.2.1</b> ITD tuning</a></li>
<li class="chapter" data-level="3.2.2" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html#cloud2trees-point-cloud-processing-1"><i class="fa fa-check"></i><b>3.2.2</b> <code>cloud2trees</code> point cloud processing</a></li>
<li class="chapter" data-level="3.2.3" data-path="sycan-marsh-or.html"><a href="sycan-marsh-or.html#cloud2trees-results-1"><i class="fa fa-check"></i><b>3.2.3</b> <code>cloud2trees</code> Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="fort-stewart-ga.html"><a href="fort-stewart-ga.html"><i class="fa fa-check"></i><b>4</b> Fort Stewart (GA)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="fort-stewart-ga.html"><a href="fort-stewart-ga.html#als-processing-1"><i class="fa fa-check"></i><b>4.1</b> ALS Processing</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="fort-stewart-ga.html"><a href="fort-stewart-ga.html#itd-tuning-2"><i class="fa fa-check"></i><b>4.1.1</b> ITD tuning</a></li>
<li class="chapter" data-level="4.1.2" data-path="fort-stewart-ga.html"><a href="fort-stewart-ga.html#cloud2trees-point-cloud-processing-2"><i class="fa fa-check"></i><b>4.1.2</b> <code>cloud2trees</code> point cloud processing</a></li>
<li class="chapter" data-level="4.1.3" data-path="fort-stewart-ga.html"><a href="fort-stewart-ga.html#cloud2trees-results-2"><i class="fa fa-check"></i><b>4.1.3</b> <code>cloud2trees</code> Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html"><i class="fa fa-check"></i><b>5</b> Salt Cabin (CO)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html#als-processing-2"><i class="fa fa-check"></i><b>5.1</b> ALS Processing</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html#itd-tuning-3"><i class="fa fa-check"></i><b>5.1.1</b> ITD tuning</a></li>
<li class="chapter" data-level="5.1.2" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html#cloud2trees-point-cloud-processing-3"><i class="fa fa-check"></i><b>5.1.2</b> <code>cloud2trees</code> point cloud processing</a></li>
<li class="chapter" data-level="5.1.3" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html#cloud2trees-results-3"><i class="fa fa-check"></i><b>5.1.3</b> <code>cloud2trees</code> Results</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html#uas-sfm-processing"><i class="fa fa-check"></i><b>5.2</b> UAS sfm Processing</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html#itd-tuning-4"><i class="fa fa-check"></i><b>5.2.1</b> ITD tuning</a></li>
<li class="chapter" data-level="5.2.2" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html#cloud2trees-point-cloud-processing-4"><i class="fa fa-check"></i><b>5.2.2</b> <code>cloud2trees</code> point cloud processing</a></li>
<li class="chapter" data-level="5.2.3" data-path="salt-cabin-co.html"><a href="salt-cabin-co.html#cloud2trees-results-4"><i class="fa fa-check"></i><b>5.2.3</b> <code>cloud2trees</code> Results</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DoD cloud2trees Demonstration: Forest Fuel Quantification for Wildfire Modeling using QUIC-Fire</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-preparation" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Section 2</span> Data Preparation<a href="data-preparation.html#data-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Let’s check out the data we need to process and create: 1) a processing data frame; 2) a LAS catalog (<code>lidR</code> package) with information on the point cloud data</p>
<p>The priority list for processing this data is:</p>
<ul>
<li>Sycan ALS</li>
<li>Fort Stewart ALS</li>
<li>New Jersey ALS</li>
<li>Salt Cabin SfM</li>
<li>Fort Stewart UAS Lidar</li>
<li>Sycan UAS Lidar</li>
<li>Salt Cabin ALS</li>
</ul>
<p>I debated creating an automated pipeline to process all of the data but instead will create individual sections for each of the study sites and process them manually. This will overcome the challenge of defining unique variable window functions for use in ITD which we’ll tune using <code>cloud2trees::itd_tuning()</code></p>
<p>Load the standard libraries we use to do work</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-preparation.html#cb1-1" tabindex="-1"></a><span class="co"># bread-and-butter</span></span>
<span id="cb1-2"><a href="data-preparation.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># the tidyverse</span></span>
<span id="cb1-3"><a href="data-preparation.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(viridis) <span class="co"># viridis colors</span></span>
<span id="cb1-4"><a href="data-preparation.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(harrypotter) <span class="co"># hp colors</span></span>
<span id="cb1-5"><a href="data-preparation.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># brewer colors</span></span>
<span id="cb1-6"><a href="data-preparation.html#cb1-6" tabindex="-1"></a><span class="fu">library</span>(scales) <span class="co"># work with number and plot scales</span></span>
<span id="cb1-7"><a href="data-preparation.html#cb1-7" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb1-8"><a href="data-preparation.html#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="data-preparation.html#cb1-9" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb1-10"><a href="data-preparation.html#cb1-10" tabindex="-1"></a><span class="fu">library</span>(mapview) <span class="co"># interactive html maps</span></span>
<span id="cb1-11"><a href="data-preparation.html#cb1-11" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># tables</span></span>
<span id="cb1-12"><a href="data-preparation.html#cb1-12" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combine plots</span></span>
<span id="cb1-13"><a href="data-preparation.html#cb1-13" tabindex="-1"></a><span class="fu">library</span>(ggmap) <span class="co"># correlation plots</span></span>
<span id="cb1-14"><a href="data-preparation.html#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="data-preparation.html#cb1-15" tabindex="-1"></a><span class="co"># spatial analysis</span></span>
<span id="cb1-16"><a href="data-preparation.html#cb1-16" tabindex="-1"></a><span class="fu">library</span>(terra) <span class="co"># raster</span></span>
<span id="cb1-17"><a href="data-preparation.html#cb1-17" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># simple features</span></span>
<span id="cb1-18"><a href="data-preparation.html#cb1-18" tabindex="-1"></a><span class="fu">library</span>(lidR) <span class="co"># lidar data</span></span>
<span id="cb1-19"><a href="data-preparation.html#cb1-19" tabindex="-1"></a><span class="fu">library</span>(rgl) <span class="co"># 3d plots</span></span>
<span id="cb1-20"><a href="data-preparation.html#cb1-20" tabindex="-1"></a><span class="fu">library</span>(cloud2trees) <span class="co"># the cloud2trees</span></span></code></pre></div>
<div id="study-sites" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Study Sites<a href="data-preparation.html#study-sites" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s check out the vector data of the study sites</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-preparation.html#cb2-1" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data&quot;</span></span>
<span id="cb2-2"><a href="data-preparation.html#cb2-2" tabindex="-1"></a><span class="co"># what vector data?</span></span>
<span id="cb2-3"><a href="data-preparation.html#cb2-3" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span></span>
<span id="cb2-4"><a href="data-preparation.html#cb2-4" tabindex="-1"></a>  <span class="fu">list.files</span>(dir_temp, <span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(shp|gpkg)$&quot;</span>, <span class="at">recursive =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="data-preparation.html#cb2-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="data-preparation.html#cb2-6" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="st">&quot;fpath&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="data-preparation.html#cb2-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb2-8"><a href="data-preparation.html#cb2-8" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">str_detect</span>(fpath, <span class="st">&quot;point_cloud_processing&quot;</span>)</span>
<span id="cb2-9"><a href="data-preparation.html#cb2-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="data-preparation.html#cb2-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-11"><a href="data-preparation.html#cb2-11" tabindex="-1"></a>    <span class="at">study_site =</span> <span class="fu">dirname</span>(fpath)</span>
<span id="cb2-12"><a href="data-preparation.html#cb2-12" tabindex="-1"></a>    , <span class="at">fpath =</span> <span class="fu">file.path</span>(dir_temp, fpath)</span>
<span id="cb2-13"><a href="data-preparation.html#cb2-13" tabindex="-1"></a>    , <span class="at">fdir =</span> <span class="fu">dirname</span>(fpath)</span>
<span id="cb2-14"><a href="data-preparation.html#cb2-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-15"><a href="data-preparation.html#cb2-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(study_site) <span class="sc">%&gt;%</span> </span>
<span id="cb2-16"><a href="data-preparation.html#cb2-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-17"><a href="data-preparation.html#cb2-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb2-18"><a href="data-preparation.html#cb2-18" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(df_temp)<span class="sc">==</span><span class="dv">0</span>){<span class="fu">stop</span>(<span class="st">&quot;no vector data found&quot;</span>)}</span>
<span id="cb2-19"><a href="data-preparation.html#cb2-19" tabindex="-1"></a><span class="co"># load in the vector data</span></span>
<span id="cb2-20"><a href="data-preparation.html#cb2-20" tabindex="-1"></a>study_sites_sf <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb2-21"><a href="data-preparation.html#cb2-21" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb2-22"><a href="data-preparation.html#cb2-22" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb2-23"><a href="data-preparation.html#cb2-23" tabindex="-1"></a>      <span class="at">dsn =</span> df_temp<span class="sc">$</span>fpath[x]</span>
<span id="cb2-24"><a href="data-preparation.html#cb2-24" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb2-25"><a href="data-preparation.html#cb2-25" tabindex="-1"></a>    <span class="co"># put all in the same projection</span></span>
<span id="cb2-26"><a href="data-preparation.html#cb2-26" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">5070</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-27"><a href="data-preparation.html#cb2-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">study_site =</span> df_temp<span class="sc">$</span>study_site[x]) <span class="sc">%&gt;%</span> </span>
<span id="cb2-28"><a href="data-preparation.html#cb2-28" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(study_site)</span>
<span id="cb2-29"><a href="data-preparation.html#cb2-29" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-30"><a href="data-preparation.html#cb2-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-31"><a href="data-preparation.html#cb2-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(df_temp, <span class="at">by =</span> <span class="st">&quot;study_site&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `Burn Unit F6_6&#39; from data source 
##   `C:\Data\usfs\dod_cloud2trees_demo\data\FortStewart\Burn Unit F6_6.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 6 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 431049.1 ymin: 3543511 xmax: 434589.8 ymax: 3545826
## Projected CRS: WGS 84 / UTM zone 17N
## Reading layer `CB_BurnBlock&#39; from data source 
##   `C:\Data\usfs\dod_cloud2trees_demo\data\NewJersey\CB_BurnBlock.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 13 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 525216.5 ymin: 365372.9 xmax: 529448.3 ymax: 370453.3
## Projected CRS: NAD83 / New Jersey (ftUS)
## Reading layer `SaltCabin_Unit2_Boundary&#39; from data source 
##   `C:\Data\usfs\dod_cloud2trees_demo\data\SaltCabin\SaltCabin_Unit2_Boundary.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 4 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 453612.2 ymin: 4502029 xmax: 454053.5 ymax: 4502398
## Projected CRS: NAD83 / UTM zone 13N
## Reading layer `Sycan_2A&#39; from data source 
##   `C:\Data\usfs\dod_cloud2trees_demo\data\SycanMarsh\Sycan_2A.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 10 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 4748335 ymin: 436780.6 xmax: 4750706 ymax: 438275.2
## Projected CRS: NAD_1983_StatePlane_Oregon_South_FIPS_3602_Feet</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-preparation.html#cb4-1" tabindex="-1"></a><span class="co"># figure out where the point cloud data is</span></span>
<span id="cb4-2"><a href="data-preparation.html#cb4-2" tabindex="-1"></a>ptcld_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb4-3"><a href="data-preparation.html#cb4-3" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(study_sites_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="data-preparation.html#cb4-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb4-5"><a href="data-preparation.html#cb4-5" tabindex="-1"></a>    <span class="co"># look for dirs with las/laz</span></span>
<span id="cb4-6"><a href="data-preparation.html#cb4-6" tabindex="-1"></a>      dirs <span class="ot">&lt;-</span></span>
<span id="cb4-7"><a href="data-preparation.html#cb4-7" tabindex="-1"></a>        study_sites_sf<span class="sc">$</span>fdir[x] <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="data-preparation.html#cb4-8" tabindex="-1"></a>        <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="data-preparation.html#cb4-9" tabindex="-1"></a>        <span class="fu">dirname</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="data-preparation.html#cb4-10" tabindex="-1"></a>        <span class="fu">tolower</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="data-preparation.html#cb4-11" tabindex="-1"></a>        <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-12"><a href="data-preparation.html#cb4-12" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">keep</span>(</span>
<span id="cb4-13"><a href="data-preparation.html#cb4-13" tabindex="-1"></a>          <span class="sc">~</span> <span class="sc">!</span><span class="fu">str_detect</span>(.x, <span class="st">&quot;point_cloud_processing&quot;</span>)</span>
<span id="cb4-14"><a href="data-preparation.html#cb4-14" tabindex="-1"></a>        )</span>
<span id="cb4-15"><a href="data-preparation.html#cb4-15" tabindex="-1"></a>    <span class="co"># gen df</span></span>
<span id="cb4-16"><a href="data-preparation.html#cb4-16" tabindex="-1"></a>    df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb4-17"><a href="data-preparation.html#cb4-17" tabindex="-1"></a>        <span class="at">als_dir =</span> <span class="fu">character</span>(<span class="dv">1</span>)</span>
<span id="cb4-18"><a href="data-preparation.html#cb4-18" tabindex="-1"></a>        , <span class="at">uas_lidar_dir =</span> <span class="fu">character</span>(<span class="dv">1</span>)</span>
<span id="cb4-19"><a href="data-preparation.html#cb4-19" tabindex="-1"></a>        , <span class="at">uas_sfm_dir =</span> <span class="fu">character</span>(<span class="dv">1</span>)</span>
<span id="cb4-20"><a href="data-preparation.html#cb4-20" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-21"><a href="data-preparation.html#cb4-21" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb4-22"><a href="data-preparation.html#cb4-22" tabindex="-1"></a>       <span class="at">als_dir =</span> purrr<span class="sc">::</span><span class="fu">keep</span>(dirs, <span class="sc">~</span> <span class="fu">str_detect</span>(.x, <span class="st">&quot;als&quot;</span>))[<span class="dv">1</span>] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="fu">as.character</span>(<span class="cn">NA</span>))</span>
<span id="cb4-23"><a href="data-preparation.html#cb4-23" tabindex="-1"></a>        , <span class="at">uas_lidar_dir =</span> purrr<span class="sc">::</span><span class="fu">keep</span>(dirs, <span class="sc">~</span> <span class="fu">str_detect</span>(.x, <span class="st">&quot;uas&quot;</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(.x, <span class="st">&quot;lidar&quot;</span>))[<span class="dv">1</span>] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="fu">as.character</span>(<span class="cn">NA</span>))</span>
<span id="cb4-24"><a href="data-preparation.html#cb4-24" tabindex="-1"></a>        , <span class="at">uas_sfm_dir =</span> purrr<span class="sc">::</span><span class="fu">keep</span>(dirs, <span class="sc">~</span> <span class="fu">str_detect</span>(.x, <span class="st">&quot;uas&quot;</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(.x, <span class="st">&quot;sfm&quot;</span>))[<span class="dv">1</span>] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="fu">as.character</span>(<span class="cn">NA</span>))</span>
<span id="cb4-25"><a href="data-preparation.html#cb4-25" tabindex="-1"></a>        , <span class="at">fdir =</span> study_sites_sf<span class="sc">$</span>fdir[x]</span>
<span id="cb4-26"><a href="data-preparation.html#cb4-26" tabindex="-1"></a>      )</span>
<span id="cb4-27"><a href="data-preparation.html#cb4-27" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb4-28"><a href="data-preparation.html#cb4-28" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb4-29"><a href="data-preparation.html#cb4-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb4-30"><a href="data-preparation.html#cb4-30" tabindex="-1"></a><span class="co"># add ptcld dirs to data</span></span>
<span id="cb4-31"><a href="data-preparation.html#cb4-31" tabindex="-1"></a>study_sites_sf <span class="ot">&lt;-</span> study_sites_sf <span class="sc">%&gt;%</span> </span>
<span id="cb4-32"><a href="data-preparation.html#cb4-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(ptcld_df_temp, <span class="at">by =</span> <span class="st">&quot;fdir&quot;</span>)</span>
<span id="cb4-33"><a href="data-preparation.html#cb4-33" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb4-34"><a href="data-preparation.html#cb4-34" tabindex="-1"></a>study_sites_sf <span class="sc">%&gt;%</span> </span>
<span id="cb4-35"><a href="data-preparation.html#cb4-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 4
## Columns: 7
## $ study_site    &lt;chr&gt; &quot;FortStewart&quot;, &quot;NewJersey&quot;, &quot;SaltCabin&quot;, &quot;SycanMarsh&quot;
## $ fpath         &lt;chr&gt; &quot;../data/FortStewart/Burn Unit F6_6.shp&quot;, &quot;../data/NewJe…
## $ fdir          &lt;chr&gt; &quot;../data/FortStewart&quot;, &quot;../data/NewJersey&quot;, &quot;../data/Sal…
## $ als_dir       &lt;chr&gt; &quot;../data/fortstewart/als_2018_laz_files&quot;, &quot;../data/newje…
## $ uas_lidar_dir &lt;chr&gt; &quot;../data/fortstewart/uas_lidar&quot;, NA, NA, &quot;../data/sycanm…
## $ uas_sfm_dir   &lt;chr&gt; NA, NA, &quot;../data/saltcabin/uas_sfm&quot;, NA
## $ geometry      &lt;POLYGON [m]&gt; POLYGON ((1336943 1097560, ..., POLYGON ((1817860 207637…</code></pre>
<p>where are these places?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-preparation.html#cb6-1" tabindex="-1"></a><span class="co"># first plot a point so we can see it on the map</span></span>
<span id="cb6-2"><a href="data-preparation.html#cb6-2" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb6-3"><a href="data-preparation.html#cb6-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_centroid</span>(study_sites_sf)</span>
<span id="cb6-4"><a href="data-preparation.html#cb6-4" tabindex="-1"></a>  , <span class="at">zcol =</span> <span class="st">&quot;study_site&quot;</span></span>
<span id="cb6-5"><a href="data-preparation.html#cb6-5" tabindex="-1"></a>  , <span class="at">cex =</span> <span class="dv">5</span></span>
<span id="cb6-6"><a href="data-preparation.html#cb6-6" tabindex="-1"></a>  , <span class="at">label =</span> T</span>
<span id="cb6-7"><a href="data-preparation.html#cb6-7" tabindex="-1"></a>  , <span class="at">legend =</span> T</span>
<span id="cb6-8"><a href="data-preparation.html#cb6-8" tabindex="-1"></a>  , <span class="at">popup =</span> T</span>
<span id="cb6-9"><a href="data-preparation.html#cb6-9" tabindex="-1"></a>  , <span class="at">layer.name =</span> <span class="st">&quot;study areas&quot;</span></span>
<span id="cb6-10"><a href="data-preparation.html#cb6-10" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb6-11"><a href="data-preparation.html#cb6-11" tabindex="-1"></a><span class="co"># add the study bounds</span></span>
<span id="cb6-12"><a href="data-preparation.html#cb6-12" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb6-13"><a href="data-preparation.html#cb6-13" tabindex="-1"></a>  study_sites_sf</span>
<span id="cb6-14"><a href="data-preparation.html#cb6-14" tabindex="-1"></a>  , <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb6-15"><a href="data-preparation.html#cb6-15" tabindex="-1"></a>  , <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb6-16"><a href="data-preparation.html#cb6-16" tabindex="-1"></a>  , <span class="at">alpha.regions =</span> <span class="dv">0</span></span>
<span id="cb6-17"><a href="data-preparation.html#cb6-17" tabindex="-1"></a>  , <span class="at">label =</span> F</span>
<span id="cb6-18"><a href="data-preparation.html#cb6-18" tabindex="-1"></a>  , <span class="at">legend =</span> F</span>
<span id="cb6-19"><a href="data-preparation.html#cb6-19" tabindex="-1"></a>  , <span class="at">popup =</span> F</span>
<span id="cb6-20"><a href="data-preparation.html#cb6-20" tabindex="-1"></a>)</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-95849ba70bd4e54a7af7" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-95849ba70bd4e54a7af7">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[32.03503090668134,39.8428248140954,40.66962166475252,42.86545812512576],[-81.71296572494636,-74.37516137134671,-105.5460757348043,-121.1396191216853],5,null,"study areas",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":[0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#4B0055","#007094","#00BE7D","#FDE333"],"fillOpacity":[0.6,0.6,0.6,0.6]},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>study_site&emsp;<\/th><td>FortStewart&emsp;<\/td><\/tr><tr><td>2<\/td><th>fpath&emsp;<\/th><td>../data/FortStewart/Burn Unit F6_6.shp&emsp;<\/td><\/tr><tr><td>3<\/td><th>fdir&emsp;<\/th><td>../data/FortStewart&emsp;<\/td><\/tr><tr><td>4<\/td><th>als_dir&emsp;<\/th><td>../data/fortstewart/als_2018_laz_files&emsp;<\/td><\/tr><tr><td>5<\/td><th>uas_lidar_dir&emsp;<\/th><td>../data/fortstewart/uas_lidar&emsp;<\/td><\/tr><tr><td>6<\/td><th>uas_sfm_dir&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>7<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>study_site&emsp;<\/th><td>NewJersey&emsp;<\/td><\/tr><tr><td>2<\/td><th>fpath&emsp;<\/th><td>../data/NewJersey/CB_BurnBlock.shp&emsp;<\/td><\/tr><tr><td>3<\/td><th>fdir&emsp;<\/th><td>../data/NewJersey&emsp;<\/td><\/tr><tr><td>4<\/td><th>als_dir&emsp;<\/th><td>../data/newjersey/als_jfsp_clipped&emsp;<\/td><\/tr><tr><td>5<\/td><th>uas_lidar_dir&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>6<\/td><th>uas_sfm_dir&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>7<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>study_site&emsp;<\/th><td>SaltCabin&emsp;<\/td><\/tr><tr><td>2<\/td><th>fpath&emsp;<\/th><td>../data/SaltCabin/SaltCabin_Unit2_Boundary.shp&emsp;<\/td><\/tr><tr><td>3<\/td><th>fdir&emsp;<\/th><td>../data/SaltCabin&emsp;<\/td><\/tr><tr><td>4<\/td><th>als_dir&emsp;<\/th><td>../data/saltcabin/als_2021&emsp;<\/td><\/tr><tr><td>5<\/td><th>uas_lidar_dir&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>6<\/td><th>uas_sfm_dir&emsp;<\/th><td>../data/saltcabin/uas_sfm&emsp;<\/td><\/tr><tr><td>7<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>study_site&emsp;<\/th><td>SycanMarsh&emsp;<\/td><\/tr><tr><td>2<\/td><th>fpath&emsp;<\/th><td>../data/SycanMarsh/Sycan_2A.shp&emsp;<\/td><\/tr><tr><td>3<\/td><th>fdir&emsp;<\/th><td>../data/SycanMarsh&emsp;<\/td><\/tr><tr><td>4<\/td><th>als_dir&emsp;<\/th><td>../data/sycanmarsh/als_2021_laz_files&emsp;<\/td><\/tr><tr><td>5<\/td><th>uas_lidar_dir&emsp;<\/th><td>../data/sycanmarsh/uas_lidar_las_files/lidars/terra_las&emsp;<\/td><\/tr><tr><td>6<\/td><th>uas_sfm_dir&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>7<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"TRUE",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#007094","#00BE7D","#FDE333"],"labels":["FortStewart","NewJersey","SaltCabin","SycanMarsh"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"study areas","extra":null,"layerId":null,"className":"info legend","group":"study areas"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-81.72176654298957,-81.72157133313586,-81.72115445222452,-81.72055441776334,-81.72023580330679,-81.72003136076692,-81.71932932877183,-81.71899090755073,-81.71883379544769,-81.71828100122198,-81.71792704067347,-81.71766737555845,-81.7170362245312,-81.71684432315074,-81.71675063066236,-81.71669603269456,-81.71643546569001,-81.71621608222266,-81.71601757167073,-81.71589402183648,-81.71583192977674,-81.71583075367457,-81.715867154077,-81.71596761913499,-81.71608860447013,-81.71622274056419,-81.71631994688597,-81.71634626154379,-81.71635208788361,-81.71633756927955,-81.71629593092653,-81.71618600339531,-81.7160072832424,-81.71576685944646,-81.7155986442843,-81.71546781462341,-81.71521989729699,-81.71498546400451,-81.71476099668577,-81.71464377284326,-81.71455417756171,-81.71450492570931,-81.71447638487106,-81.71449550342477,-81.71455203864647,-81.71461204100011,-81.71465861374544,-81.71467134031926,-81.71467027148411,-81.71463481551876,-81.71457190727332,-81.71446443824429,-81.71436754484741,-81.71420119746865,-81.71400077835484,-81.71388671211452,-81.71380402041586,-81.71368032519278,-81.71346805482791,-81.71320760408796,-81.71291336183602,-81.71263948365338,-81.71223184663107,-81.71200587176344,-81.71180653041607,-81.71141547985275,-81.71117560779183,-81.71092516379716,-81.71075352194786,-81.71041013549551,-81.7100460412257,-81.70972695805636,-81.70945232754546,-81.70914317661672,-81.70867263499876,-81.7084943299983,-81.70829531624105,-81.70804836886106,-81.70782244389935,-81.7076243691394,-81.70743315621978,-81.70726953284714,-81.7070584447288,-81.70687452835587,-81.70659519519891,-81.70633651862349,-81.70609858716162,-81.7057718743828,-81.7054183177368,-81.7051123467604,-81.70470101156003,-81.70448331729935,-81.70423127668437,-81.70400623525732,-81.70377426443902,-81.70348065218887,-81.70318023179412,-81.70290691470329,-81.70270201699347,-81.70253409907383,-81.70241056211584,-81.70226661424152,-81.70203293824964,-81.70184747323353,-81.7015589578758,-81.70139737392485,-81.70130808529591,-81.70117005486968,-81.70105226374849,-81.70096940584816,-81.70085265087407,-81.70073594773196,-81.70055102093339,-81.70032847597093,-81.7001636856908,-81.69993774692671,-81.69975265079226,-81.69956737860969,-81.69943741863231,-81.69930062927804,-81.69917106381294,-81.69895272322489,-81.69873450265791,-81.69845459206128,-81.69828081910694,-81.69811030414203,-81.69787837886206,-81.69769429585517,-81.69751007612668,-81.69733238966624,-81.69718898342109,-81.6970519909562,-81.69685990005826,-81.69668162343267,-81.69651666991737,-81.69638296069398,-81.69630041946021,-81.69619701969424,-81.69612080742216,-81.69603806216044,-81.69597622681719,-81.69588673717556,-81.69576304310763,-81.69564665678676,-81.69546866757298,-81.69520227080487,-81.6949462694121,-81.69462532223592,-81.694290943856,-81.69408607596075,-81.69389465708184,-81.69371700121543,-81.69353217533856,-81.69333292446206,-81.69321270540179,-81.69313666903956,-81.69306714062893,-81.69294848275112,-81.69280895246649,-81.69271857754006,-81.69269229079026,-81.6927977681684,-81.69330059889616,-81.69450637665921,-81.69491628581888,-81.69547500381614,-81.69603363560323,-81.69696035157648,-81.69752826333756,-81.69827314415375,-81.69887374542751,-81.6994697812401,-81.69997256732663,-81.70030943587388,-81.7004134280883,-81.70138608156834,-81.70205813588396,-81.70278675719646,-81.70340301150192,-81.70411777043913,-81.70460350735915,-81.70522965544713,-81.70607122899104,-81.70701016725661,-81.70769275623539,-81.70844020903486,-81.70865513133505,-81.70894421563345,-81.70913085457384,-81.70980615849717,-81.71025331841312,-81.71105419592233,-81.71226992205668,-81.71274508565358,-81.7133409640055,-81.7138905129891,-81.71429146322997,-81.71478510346311,-81.71523652372106,-81.71558058570638,-81.71608248923992,-81.71664043839652,-81.71704901974105,-81.71739224799445,-81.7177393365815,-81.71782479351369,-81.71788105861816,-81.71816339688343,-81.71845956047777,-81.71878088282287,-81.71903833094221,-81.71925034201271,-81.71940510097005,-81.71961243352612,-81.71982613186891,-81.72003380639453,-81.72021531374958,-81.72035810791729,-81.72058488463615,-81.7208183949372,-81.72112309278599,-81.72135627710971,-81.72146017080365,-81.72158315971448,-81.72167371822221,-81.72177542561109,-81.72190261692633,-81.72206786862981,-81.72243552932957,-81.72287989763291,-81.72352683521302,-81.72429426279442,-81.7247130722572,-81.72515720921577,-81.72561434231851,-81.72617369950008,-81.72706972205657,-81.72755287554227,-81.72784493183147,-81.72820090243532,-81.72845505265649,-81.72937645242851,-81.72973232742886,-81.73015161086947,-81.7302280146021,-81.73034000339817,-81.73020374602167,-81.72983386851421,-81.72942108824668,-81.72867391601255,-81.72831208827661,-81.72806827851522,-81.72771799903364,-81.72736041981553,-81.72690197940776,-81.72645780650258,-81.7261138501368,-81.72560246876135,-81.72512464078234,-81.72477453007124,-81.72446368208684,-81.72396155410222,-81.72347325692235,-81.72325260841578,-81.72295504755823,-81.72274230751358,-81.72243913807947,-81.72217527292852,-81.72184263393214,-81.72176654298957],"lat":[32.04625978675614,32.04626991943365,32.04629258977374,32.04634336418206,32.04636096222555,32.04637565570475,32.04642023751767,32.04644471089677,32.0464591340063,32.04649835300624,32.04652516695131,32.04654693541806,32.04659786934918,32.04660797604415,32.04652054678898,32.0464802589967,32.04630130306155,32.04614015679127,32.04602399943371,32.0459277167161,32.04581755471153,32.04566645225446,32.04553769121252,32.04530482181946,32.04507183643716,32.04482749984276,32.04460141464943,32.04449526404444,32.0443508880818,32.04422918067365,32.04415273369258,32.04402028848261,32.04385214594409,32.04362345679107,32.04344397754097,32.04330488357352,32.04296346758949,32.04261069823917,32.0422623829576,32.0420848702418,32.04192749994794,32.04176539150776,32.04158512343871,32.04140458678101,32.04122609460498,32.04106788111277,32.04092778618313,32.04077660521632,32.0406390341782,32.04046331581559,32.04029000752323,32.04004703408663,32.0398445974755,32.0395207624772,32.0391565225875,32.03895869299413,32.03883736898546,32.03872078645223,32.03857763789695,32.03840995101358,32.03823794286166,32.03808837318726,32.03784708445641,32.03768596747088,32.03750214692131,32.0371795692953,32.03697567684855,32.03677409857241,32.03661944072507,32.03629659269758,32.0359490506582,32.03564410752161,32.03539529895418,32.03509029871529,32.03462832424251,32.03446693436062,32.03428085087936,32.03410180083863,32.03398803855471,32.03392373848658,32.0338909749422,32.03387384478175,32.03388178811142,32.03389409035015,32.03393624382291,32.03399632454394,32.03404275702518,32.03412125837337,32.03423824944618,32.03434595346781,32.03448130676355,32.03453438985403,32.03455383284231,32.03455508250116,32.0345157736296,32.03446552950041,32.03439051341349,32.03431083563417,32.03421950127884,32.03411668487419,32.03401813313538,32.03389037454921,32.03367064256354,32.03347996306208,32.03318610657895,32.03300206036089,32.03288076438837,32.03266050171535,32.03244689308721,32.03230075226067,32.03217960777319,32.03206522898994,32.03194446092051,32.03179458055815,32.03166693459275,32.03150579542547,32.03136247341537,32.03123945041225,32.03116574015697,32.03110785500631,32.03108601577028,32.03105338891389,32.03103654859822,32.03100200476214,32.03099845104941,32.03098811305632,32.0309533037623,32.03094303987905,32.03091473352986,32.03087511414043,32.03081726308085,32.03073231217363,32.03058225821319,32.03042085121263,32.03027064761946,32.03013831518092,32.03003276607812,32.02988222404706,32.02973829879127,32.02960568619073,32.02952483227385,32.0294193210178,32.02929820977862,32.02922442109132,32.02914420404829,32.02905770533925,32.02898919205718,32.0289097571686,32.02884843795967,32.02880219666574,32.02874009385626,32.02865987250309,32.02855037029422,32.02837103019102,32.02822734369754,32.0281059693045,32.02792591965461,32.0275499211581,32.02712667375759,32.02685877828531,32.02679577147644,32.02678391844015,32.0267157647114,32.02656707866185,32.02650844887501,32.02643546954815,32.02635121138593,32.02623560857459,32.02615354821634,32.02606148955088,32.02597022170618,32.02588799768713,32.02581530708089,32.02581344728727,32.02582414983305,32.02600596984592,32.02612855185084,32.02629141345657,32.02643008509479,32.02664037863836,32.02680457805455,32.02702437904559,32.02732868165641,32.02764145730251,32.02788348499696,32.02812514663135,32.02818709607347,32.02821028932456,32.02820924578624,32.02814908354401,32.02811500474198,32.02803157882191,32.02793003089402,32.02787999846355,32.02782026381333,32.02776078718613,32.02774274186093,32.02768583163055,32.02760434858506,32.02750542685095,32.02731990909268,32.02714986021682,32.02696486599292,32.026717089931,32.02641290694804,32.02633799618242,32.0264662335529,32.02710966960205,32.02787030559696,32.02867365010231,32.02934880005154,32.0298415225754,32.03029171757964,32.03098970406038,32.03173952732791,32.03248036286879,32.0331333874209,32.03366033123806,32.03443037676966,32.03525676754757,32.03633986416043,32.03712340360193,32.03749945783939,32.03790472298634,32.038183872354,32.03832312579461,32.03846223405358,32.03860112543126,32.03888997260788,32.03925280825842,32.03974304201004,32.04031828776611,32.04066998599364,32.04100123969592,32.04142714249817,32.04197199213473,32.04285772339296,32.04334887507368,32.04361558629664,32.04396988866801,32.04421426257333,32.04512238457323,32.04546315086508,32.04586895627347,32.04594519832704,32.04600093712632,32.04601525416287,32.04603768227845,32.04607614366919,32.04614584581913,32.04618175537342,32.04619894331513,32.04623027414071,32.04625939052553,32.04630036105188,32.04634575888073,32.04638155976307,32.0464250841722,32.04648420210815,32.04649522563431,32.04649023632545,32.04644799765551,32.04639665663191,32.04637085134534,32.04632969680085,32.04629933480701,32.04626046637939,32.04625294834485,32.04625484280576,32.04625978675614]}]],[[{"lng":[-74.38075479584413,-74.38056118632859,-74.38110908320625,-74.38138220604999,-74.38193084564368,-74.38213421285715,-74.382017660957,-74.38177073293629,-74.37986204926348,-74.37918483922699,-74.37832272644911,-74.37746094517206,-74.37690733604022,-74.37629166974182,-74.37555264548193,-74.3752442084335,-74.37475094420057,-74.37456629259508,-74.37315027756495,-74.37167279348493,-74.36708227056621,-74.3804372248172,-74.38075479584413],"lat":[39.83690029083665,39.83688329747353,39.84034242683737,39.84256302013058,39.8456378576152,39.84775206165457,39.8479056046834,39.84833232879539,39.84870990172417,39.84880408166367,39.84904038960044,39.84908692411781,39.8488965706651,39.84899079899542,39.84922721752648,39.84960642002019,39.85008030547243,39.85008010596371,39.85026833265805,39.8504090333778,39.83702528842414,39.83647051873639,39.83690029083665]}]],[[{"lng":[-105.5484641258779,-105.5483301719728,-105.5482366666672,-105.5481544281888,-105.5480376286025,-105.5478748197758,-105.5477298532438,-105.5475506869272,-105.5474584858638,-105.5473368493287,-105.5471337714803,-105.5469594770934,-105.5467496438394,-105.5466385150167,-105.5464463432072,-105.5462197896522,-105.5458829023802,-105.5457317219884,-105.5455396226803,-105.5453941487462,-105.5451733010677,-105.5449410763297,-105.5447958546309,-105.5446212354704,-105.5444580296153,-105.5442887213691,-105.5441719250375,-105.5440204931216,-105.5438287906858,-105.5436951623818,-105.5436314532764,-105.5436249554974,-105.5437229048738,-105.5437917809561,-105.5438370387822,-105.5439286690375,-105.5440083459023,-105.5440708305695,-105.544080948282,-105.5440275022453,-105.5439971704806,-105.5440366845343,-105.5440478457273,-105.5439592975527,-105.5439112710583,-105.5438281784514,-105.5437806560955,-105.5438027628862,-105.5438368580266,-105.5438418092181,-105.5442895526673,-105.5445568341883,-105.5450166387821,-105.545312162602,-105.5455786495788,-105.5458748210603,-105.5462582074421,-105.5464904563277,-105.5467236449993,-105.5470799488544,-105.5474023459266,-105.5477066145433,-105.5479167308859,-105.5480349766735,-105.5479964500773,-105.5480328229652,-105.5481560510754,-105.5484362352301,-105.5485430369213,-105.5486488597037,-105.5487897880609,-105.5488431355043,-105.5487924377269,-105.5486188709313,-105.5485503656026,-105.5484641258779],"lat":[40.67098878370786,40.67096285521139,40.67090574232541,40.670804301328,40.67074287141148,40.67074364406906,40.67079303385905,40.67092670729498,40.67102897595706,40.67108710954038,40.67114120149405,40.67115973710618,40.6710987465686,40.67101957856679,40.67098506858588,40.67101270530719,40.67105857309641,40.67105928775506,40.67103363083131,40.67102103572112,40.67103536107292,40.67108073188256,40.67109912701165,40.67107781353409,40.67102988124425,40.67094655785055,40.67088512400377,40.67085484542119,40.67087788578361,40.67089179746748,40.67092308963454,40.67083899858181,40.6707278509886,40.67061684024153,40.67046166614522,40.67028856375883,40.67007567051483,40.66989385041234,40.66970784959074,40.6695708502921,40.66941603224058,40.66926974001006,40.66921213048858,40.66904873179989,40.66886300487617,40.66865530580873,40.66853156083857,40.66838977810233,40.66829221346368,40.66818593117387,40.66818824884767,40.66816485129483,40.66822023874829,40.66809487462221,40.6679740744025,40.66792840000197,40.6678823122596,40.66784136613888,40.66791552898374,40.668113076876,40.6684303257404,40.66866353800826,40.66875994514998,40.66899846659458,40.66926429680667,40.6694456498564,40.6695823160209,40.6697138091711,40.66997452168426,40.67011569745099,40.67028327099468,40.67040698615853,40.67060646260242,40.67071354635328,40.67086883274875,40.67098878370786]}]],[[{"lng":[-121.1373473783048,-121.1374169439512,-121.1375443412801,-121.1375891966996,-121.1376823019137,-121.1376837239468,-121.1378192946631,-121.1380171019273,-121.1380243488403,-121.1382239257586,-121.1386102165618,-121.1390396761315,-121.1395081793775,-121.1399883548254,-121.1403586243054,-121.1407541569182,-121.1410012977035,-121.1413581616594,-121.1417895028625,-121.1419984038591,-121.1424112827213,-121.1426650360457,-121.142997947872,-121.1432778994964,-121.1437194110858,-121.1441869335336,-121.1446288184504,-121.1448469571976,-121.1450105817855,-121.1449954231575,-121.1448114066614,-121.1447127578605,-121.1444741771837,-121.1442784672213,-121.1440821030362,-121.1438681226393,-121.1436711970734,-121.1434747372723,-121.1433334040553,-121.1431447708347,-121.1428790626337,-121.1427148420214,-121.142594052559,-121.1424731705396,-121.1422801079457,-121.1421262380063,-121.1419799115164,-121.1419019940199,-121.1418098576191,-121.1416666476449,-121.1415537761267,-121.141407168498,-121.1412215537196,-121.1411016045782,-121.1408910142411,-121.1406646793846,-121.140574131561,-121.1405006394177,-121.1403796593252,-121.1403051368941,-121.1402128080061,-121.1401204800191,-121.140031923721,-121.1399588051584,-121.1398688178368,-121.1397404781093,-121.1395526793548,-121.1393742977962,-121.1392563144536,-121.1391672636193,-121.1390605957628,-121.1388403723674,-121.1387258786271,-121.1386077081676,-121.1384812434715,-121.1383710850562,-121.1382564039424,-121.1381249492007,-121.138031471904,-121.1379706979929,-121.1379184995456,-121.1378699775133,-121.1378088295069,-121.1377224246846,-121.1376418755766,-121.137247763963,-121.1371048495636,-121.1369992749036,-121.1368844032274,-121.1367078339592,-121.1366630185089,-121.1365197801961,-121.1363861510511,-121.1363783285027,-121.1363764330219,-121.1363206340807,-121.1362029931321,-121.136183351409,-121.1362258909804,-121.1363452863991,-121.1364607410158,-121.1365466870228,-121.1365527781815,-121.1365387412,-121.1366370119767,-121.1367579002735,-121.136867012683,-121.1369126385582,-121.1370514714993,-121.1371657936735,-121.137197360025,-121.1373015822583,-121.1373431825797,-121.1373473783048],"lat":[42.86461254036364,42.86431116344429,42.86399254998357,42.86395112723326,42.86373748368425,42.86369018588064,42.86348987153467,42.86337396047733,42.86336740994703,42.86345830694204,42.86359571088054,42.86370884006197,42.86393499078272,42.86405518497832,42.86416110300671,42.86427367475557,42.86424022546081,42.86422728978516,42.86427800150555,42.86438753815472,42.86448789759539,42.8645169911721,42.86445371052827,42.86445825270337,42.86445292660726,42.86442928938783,42.86441147798067,42.86449618414206,42.86468504236848,42.86485429251332,42.86490748629173,42.86494333773279,42.8649769203736,42.86499559345809,42.86503610167507,42.86509817093678,42.86515739481669,42.86520102108749,42.86524554188898,42.86531114148314,42.86540045723823,42.86550078155805,42.8655674808608,42.86563730002235,42.86570906756955,42.86574714136721,42.86581654623701,42.86586833659121,42.86596982952023,42.86607673553188,42.86616228774039,42.86624105094451,42.86634726709528,42.86638589116755,42.86647609641194,42.86652547489732,42.86657393775109,42.8666195569289,42.86669249295359,42.86677242561752,42.86688015633738,42.86698788697441,42.867111282785,42.86714442434435,42.86717417118531,42.86720953604168,42.86724705514376,42.86725351815626,42.86722663216118,42.86722518393705,42.86724529627227,42.86723235283112,42.86723049155407,42.86720984396799,42.86718282018842,42.86717790660558,42.86718228303685,42.86718014532599,42.86718486632478,42.86723069076287,42.86727353401122,42.86733516165273,42.86739346415639,42.86744511280197,42.86747070063647,42.86735352405002,42.86731103220522,42.86727964236606,42.86724548836745,42.86713104498718,42.86712202364418,42.86708848254762,42.86701764664659,42.86693713706902,42.86691761972697,42.86679811806904,42.86667487742027,42.86654455035313,42.86639452162208,42.86619394571976,42.86612434801196,42.86595896620636,42.86575654505868,42.86568483894207,42.86556387720687,42.86546183967533,42.86535960950866,42.86531159899111,42.86510259588719,42.86482710737594,42.86478980681524,42.86462130437127,42.86450946665045,42.86461254036364]}]]],null,"study_sites_sf",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#000000","weight":2,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":0.9,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addLayersControl","args":[["OpenStreetMap","Esri.WorldImagery"],["study areas","study_sites_sf"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addHomeButton","args":[-121.1450105817855,32.02581344728727,-74.36708227056621,42.86747070063647,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[32.03503090668134,42.86545812512576],"lng":[-121.1396191216853,-74.37516137134671]},"fitBounds":[32.02581344728727,-121.1450105817855,42.86747070063647,-74.36708227056621,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\"position\":\"relative\",\"bottomleft\":\"0px\",\"background-color\":\"rgba(255, 255, 255, 0.7)\",\"box-shadow\":\"0 0 2px #bbb\",\"background-clip\":\"padding-box\",\"margin\":\"0\",\"padding-left\":\"5px\",\"padding-right\":\"5px\",\"color\":\"#333\",\"font-size\":\"9px\",\"font-family\":\"\\\"Helvetica Neue\\\", Arial, Helvetica, sans-serif\",\"text-align\":\"left\",\"z-index\":\"700\"});\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>let’s create a pretty name for each site</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-preparation.html#cb7-1" tabindex="-1"></a>study_sites_sf <span class="ot">&lt;-</span> study_sites_sf <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="data-preparation.html#cb7-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="data-preparation.html#cb7-3" tabindex="-1"></a>    <span class="at">study_site_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_match</span>(</span>
<span id="cb7-4"><a href="data-preparation.html#cb7-4" tabindex="-1"></a>      <span class="fu">tolower</span>(study_site)</span>
<span id="cb7-5"><a href="data-preparation.html#cb7-5" tabindex="-1"></a>      , <span class="st">&quot;fortstewart&quot;</span> <span class="sc">~</span> <span class="st">&quot;Fort Stewart (GA)&quot;</span></span>
<span id="cb7-6"><a href="data-preparation.html#cb7-6" tabindex="-1"></a>      , <span class="st">&quot;newjersey&quot;</span> <span class="sc">~</span> <span class="st">&quot;Cedar Bridge (NJ)&quot;</span></span>
<span id="cb7-7"><a href="data-preparation.html#cb7-7" tabindex="-1"></a>      , <span class="st">&quot;saltcabin&quot;</span> <span class="sc">~</span> <span class="st">&quot;Salt Cabin (CO)&quot;</span></span>
<span id="cb7-8"><a href="data-preparation.html#cb7-8" tabindex="-1"></a>      , <span class="st">&quot;sycanmarsh&quot;</span> <span class="sc">~</span> <span class="st">&quot;Sycan Marsh (OR)&quot;</span></span>
<span id="cb7-9"><a href="data-preparation.html#cb7-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-10"><a href="data-preparation.html#cb7-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">coalesce</span>(study_site)</span>
<span id="cb7-11"><a href="data-preparation.html#cb7-11" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="point-cloud-data" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Point Cloud Data<a href="data-preparation.html#point-cloud-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s check out the point cloud data we got</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-preparation.html#cb8-1" tabindex="-1"></a>las_df_temp <span class="ot">&lt;-</span> study_sites_sf <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="data-preparation.html#cb8-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="data-preparation.html#cb8-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(study_site, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_dir&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="data-preparation.html#cb8-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb8-5"><a href="data-preparation.html#cb8-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(study_site)</span>
<span id="cb8-6"><a href="data-preparation.html#cb8-6" tabindex="-1"></a>    , <span class="at">values_drop_na =</span> T</span>
<span id="cb8-7"><a href="data-preparation.html#cb8-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="data-preparation.html#cb8-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb8-9"><a href="data-preparation.html#cb8-9" tabindex="-1"></a>    <span class="at">name =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(name, <span class="st">&quot;_dir&quot;</span>)</span>
<span id="cb8-10"><a href="data-preparation.html#cb8-10" tabindex="-1"></a>    , <span class="at">nm =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(study_site, name, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb8-11"><a href="data-preparation.html#cb8-11" tabindex="-1"></a>  )</span>
<span id="cb8-12"><a href="data-preparation.html#cb8-12" tabindex="-1"></a><span class="co"># directory with the downloaded .las|.laz files</span></span>
<span id="cb8-13"><a href="data-preparation.html#cb8-13" tabindex="-1"></a>study_sites_las_ctg <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(las_df_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="data-preparation.html#cb8-14" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb8-15"><a href="data-preparation.html#cb8-15" tabindex="-1"></a>    lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(las_df_temp<span class="sc">$</span>value[x])</span>
<span id="cb8-16"><a href="data-preparation.html#cb8-16" tabindex="-1"></a>  )</span>
<span id="cb8-17"><a href="data-preparation.html#cb8-17" tabindex="-1"></a><span class="fu">names</span>(study_sites_las_ctg) <span class="ot">&lt;-</span> las_df_temp<span class="sc">$</span>nm</span>
<span id="cb8-18"><a href="data-preparation.html#cb8-18" tabindex="-1"></a><span class="co"># what are these ctgs?</span></span>
<span id="cb8-19"><a href="data-preparation.html#cb8-19" tabindex="-1"></a>study_sites_las_ctg</span></code></pre></div>
<pre><code>## $FortStewart_als
## class       : LAScatalog (v1.4 format 6)
## extent      : 1336000, 1340000, 1095000, 1098000 (xmin, xmax, ymin, ymax)
## coord. ref. : NAD83(2011) / Conus Albers + NAVD88 height - Geoid12B (Meters) 
## area        : 9 km²
## points      : 43.07 million points
## type        : airborne
## density     : 4.8 points/m²
## density     : 3.1 pulses/m²
## num. files  : 9 
## 
## $FortStewart_uas_lidar
## class       : LAScatalog (v1.4 format 6)
## extent      : 418991.2, 433163, 3537929, 3550245 (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## area        : 1102.2 kunits²
## points      : 2.08 billion points
## type        : airborne
## density     : 1.9 points/units²
## density     : 1.1 pulses/units²
## num. files  : 11 
## 
## $NewJersey_als
## class       : LAScatalog (v1.2 format 1)
## extent      : 552848.7, 554163.1, 4409783, 4411353 (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## area        : 6.19 kunits²
## points      : 80.3 million points
## type        : airborne
## density     : 13 points/units²
## num. files  : 3 
## 
## $SaltCabin_als
## class       : LAScatalog (v1.4 format 0)
## extent      : -801159, -797999, 2001522, 2003352 (xmin, xmax, ymin, ymax)
## coord. ref. : NAD83 / Conus Albers 
## area        : 5.6 km²
## points      : 35.22 million points
## type        : airborne
## density     : 6.3 points/m²
## density     : 6.3 pulses/m²
## num. files  : 2 
## 
## $SaltCabin_uas_sfm
## class       : LAScatalog (v1.2 format 3)
## extent      : 453536.8, 454139, 4501977, 4502440 (xmin, xmax, ymin, ymax)
## coord. ref. : WGS 84 / UTM zone 13N 
## area        : 278704 m²
## points      : 94.51 million points
## type        : terrestrial
## density     : 339.1 points/m²
## num. files  : 1 
## 
## $SycanMarsh_als
## class       : LAScatalog (v1.4 format 6)
## extent      : 651000, 653000, 4747000, 4748000 (xmin, xmax, ymin, ymax)
## coord. ref. : NAD83(2011) / UTM zone 10N + NAVD88 height - Geoid18 (m) 
## area        : 2 km²
## points      : 68.02 million points
## type        : airborne
## density     : 34 points/m²
## density     : 25.6 pulses/m²
## num. files  : 2 
## 
## $SycanMarsh_uas_lidar
## class       : LAScatalog (v1.2 format 3)
## extent      : 651487, 652298.4, 4747227, 4747880 (xmin, xmax, ymin, ymax)
## coord. ref. : WGS 84 / UTM zone 10N 
## area        : 0.53 km²
## points      : 200.55 million points
## type        : terrestrial
## density     : 378.3 points/m²
## density     : 350.8 pulses/m²
## num. files  : 1</code></pre>
<p>plot the point cloud catalog with the stand boundary</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-preparation.html#cb10-1" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb10-2"><a href="data-preparation.html#cb10-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb10-3"><a href="data-preparation.html#cb10-3" tabindex="-1"></a>    <span class="at">data =</span> study_sites_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb10-4"><a href="data-preparation.html#cb10-4" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb10-5"><a href="data-preparation.html#cb10-5" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb10-6"><a href="data-preparation.html#cb10-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb10-7"><a href="data-preparation.html#cb10-7" tabindex="-1"></a>    <span class="at">data =</span> study_sites_las_ctg[[<span class="dv">1</span>]]<span class="sc">$</span>geometry <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(study_sites_sf))</span>
<span id="cb10-8"><a href="data-preparation.html#cb10-8" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb10-9"><a href="data-preparation.html#cb10-9" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb10-10"><a href="data-preparation.html#cb10-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="dod_cloud2trees_demo_files/figure-html/unnamed-chunk-8-1.png" width="1008" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-preparation.html#cb11-1" tabindex="-1"></a><span class="co"># lidR::st_crs(ctg_temp[[3]])</span></span></code></pre></div>
<p>let’s make a quick function to grab a background map (e.g. like a Google Map) for an AOI using the <code>ggmap</code> package</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-preparation.html#cb12-1" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb12-2"><a href="data-preparation.html#cb12-2" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb12-3"><a href="data-preparation.html#cb12-3" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb12-4"><a href="data-preparation.html#cb12-4" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb12-5"><a href="data-preparation.html#cb12-5" tabindex="-1"></a><span class="co"># Make each plot individually by landscape as solution to small multiples</span></span>
<span id="cb12-6"><a href="data-preparation.html#cb12-6" tabindex="-1"></a><span class="co"># this block defines function</span></span>
<span id="cb12-7"><a href="data-preparation.html#cb12-7" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb12-8"><a href="data-preparation.html#cb12-8" tabindex="-1"></a><span class="do">##################hack to align plots for ggmap</span></span>
<span id="cb12-9"><a href="data-preparation.html#cb12-9" tabindex="-1"></a>ggmap_bbox_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(map, <span class="at">my_crs=</span><span class="dv">3857</span>) {</span>
<span id="cb12-10"><a href="data-preparation.html#cb12-10" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(map, <span class="st">&quot;ggmap&quot;</span>)) <span class="fu">stop</span>(<span class="st">&quot;map must be a ggmap object&quot;</span>)</span>
<span id="cb12-11"><a href="data-preparation.html#cb12-11" tabindex="-1"></a>    <span class="co"># Extract the bounding box (in lat/lon) from the ggmap to a numeric vector, </span></span>
<span id="cb12-12"><a href="data-preparation.html#cb12-12" tabindex="-1"></a>    <span class="co"># and set the names to what sf::st_bbox expects:</span></span>
<span id="cb12-13"><a href="data-preparation.html#cb12-13" tabindex="-1"></a>    map_bbox <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">unlist</span>(<span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)), <span class="fu">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;ymax&quot;</span>, <span class="st">&quot;xmax&quot;</span>))</span>
<span id="cb12-14"><a href="data-preparation.html#cb12-14" tabindex="-1"></a>    <span class="co"># Convert the bbox to an sf polygon, transform it to 3857, </span></span>
<span id="cb12-15"><a href="data-preparation.html#cb12-15" tabindex="-1"></a>    <span class="co"># and convert back to a bbox (convoluted, but it works)</span></span>
<span id="cb12-16"><a href="data-preparation.html#cb12-16" tabindex="-1"></a>    bbox_3857 <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">st_transform</span>(<span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(map_bbox, <span class="at">crs =</span> <span class="dv">4326</span>)), my_crs))</span>
<span id="cb12-17"><a href="data-preparation.html#cb12-17" tabindex="-1"></a>    <span class="co"># Overwrite the bbox of the ggmap object with the transformed coordinates </span></span>
<span id="cb12-18"><a href="data-preparation.html#cb12-18" tabindex="-1"></a>    <span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)<span class="sc">$</span>ll.lat <span class="ot">&lt;-</span> bbox_3857[<span class="st">&quot;ymin&quot;</span>]</span>
<span id="cb12-19"><a href="data-preparation.html#cb12-19" tabindex="-1"></a>    <span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)<span class="sc">$</span>ll.lon <span class="ot">&lt;-</span> bbox_3857[<span class="st">&quot;xmin&quot;</span>]</span>
<span id="cb12-20"><a href="data-preparation.html#cb12-20" tabindex="-1"></a>    <span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)<span class="sc">$</span>ur.lat <span class="ot">&lt;-</span> bbox_3857[<span class="st">&quot;ymax&quot;</span>]</span>
<span id="cb12-21"><a href="data-preparation.html#cb12-21" tabindex="-1"></a>    <span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)<span class="sc">$</span>ur.lon <span class="ot">&lt;-</span> bbox_3857[<span class="st">&quot;xmax&quot;</span>]</span>
<span id="cb12-22"><a href="data-preparation.html#cb12-22" tabindex="-1"></a>    map</span>
<span id="cb12-23"><a href="data-preparation.html#cb12-23" tabindex="-1"></a>}</span>
<span id="cb12-24"><a href="data-preparation.html#cb12-24" tabindex="-1"></a>plt_crs <span class="ot">&lt;-</span> <span class="dv">3857</span></span>
<span id="cb12-25"><a href="data-preparation.html#cb12-25" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb12-26"><a href="data-preparation.html#cb12-26" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb12-27"><a href="data-preparation.html#cb12-27" tabindex="-1"></a><span class="co"># for google maps... have to:</span></span>
<span id="cb12-28"><a href="data-preparation.html#cb12-28" tabindex="-1"></a><span class="co"># 1) get api key at https://console.cloud.google.com/apis/dashboard</span></span>
<span id="cb12-29"><a href="data-preparation.html#cb12-29" tabindex="-1"></a><span class="co"># 2) run ggmap::register_google(key = &quot;mykey_xxxxxxxxx&quot;, write = T)</span></span>
<span id="cb12-30"><a href="data-preparation.html#cb12-30" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb12-31"><a href="data-preparation.html#cb12-31" tabindex="-1"></a>my_ggmap_basemap <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb12-32"><a href="data-preparation.html#cb12-32" tabindex="-1"></a>  sf_data</span>
<span id="cb12-33"><a href="data-preparation.html#cb12-33" tabindex="-1"></a>  , <span class="at">zoom_level =</span> <span class="dv">14</span> <span class="co"># from 3 (continent) to 21 (building), default value 10 (city)</span></span>
<span id="cb12-34"><a href="data-preparation.html#cb12-34" tabindex="-1"></a>  , <span class="at">buffer_box =</span> <span class="dv">2600</span></span>
<span id="cb12-35"><a href="data-preparation.html#cb12-35" tabindex="-1"></a>  , <span class="at">my_crs =</span> plt_crs</span>
<span id="cb12-36"><a href="data-preparation.html#cb12-36" tabindex="-1"></a>  , <span class="at">scale_location =</span> <span class="st">&quot;bl&quot;</span></span>
<span id="cb12-37"><a href="data-preparation.html#cb12-37" tabindex="-1"></a>  , <span class="at">my_maptype =</span> <span class="st">&quot;stamen_terrain&quot;</span></span>
<span id="cb12-38"><a href="data-preparation.html#cb12-38" tabindex="-1"></a>  <span class="do">## stamen</span></span>
<span id="cb12-39"><a href="data-preparation.html#cb12-39" tabindex="-1"></a>  <span class="co"># stamen_terrain, stamen_toner, stamen_toner_lite, stamen_watercolor, stamen_terrain_background</span></span>
<span id="cb12-40"><a href="data-preparation.html#cb12-40" tabindex="-1"></a>  <span class="co"># , stamen_toner_background, stamen_terrain_lines, stamen_terrain_labels</span></span>
<span id="cb12-41"><a href="data-preparation.html#cb12-41" tabindex="-1"></a>  <span class="co"># , stamen_toner_lines, stamen_toner_labels</span></span>
<span id="cb12-42"><a href="data-preparation.html#cb12-42" tabindex="-1"></a>  <span class="do">## googlmap</span></span>
<span id="cb12-43"><a href="data-preparation.html#cb12-43" tabindex="-1"></a>  <span class="co"># &quot;terrain&quot;, &quot;satellite&quot;, &quot;roadmap&quot;, and &quot;hybrid&quot;</span></span>
<span id="cb12-44"><a href="data-preparation.html#cb12-44" tabindex="-1"></a>  , <span class="at">add_sf_data =</span> F</span>
<span id="cb12-45"><a href="data-preparation.html#cb12-45" tabindex="-1"></a>  , <span class="at">outline_sf_data_col =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb12-46"><a href="data-preparation.html#cb12-46" tabindex="-1"></a>  , <span class="at">outline_lwd =</span> <span class="fl">0.7</span></span>
<span id="cb12-47"><a href="data-preparation.html#cb12-47" tabindex="-1"></a>) {</span>
<span id="cb12-48"><a href="data-preparation.html#cb12-48" tabindex="-1"></a>  </span>
<span id="cb12-49"><a href="data-preparation.html#cb12-49" tabindex="-1"></a>  <span class="co"># # should zoom in?</span></span>
<span id="cb12-50"><a href="data-preparation.html#cb12-50" tabindex="-1"></a>  <span class="co"># zoom_level &lt;- 14 # 11</span></span>
<span id="cb12-51"><a href="data-preparation.html#cb12-51" tabindex="-1"></a>  <span class="co"># # should buffer extend?</span></span>
<span id="cb12-52"><a href="data-preparation.html#cb12-52" tabindex="-1"></a>  <span class="co"># buffer_box &lt;- 2600 # 20000</span></span>
<span id="cb12-53"><a href="data-preparation.html#cb12-53" tabindex="-1"></a>  <span class="co"># bounding box</span></span>
<span id="cb12-54"><a href="data-preparation.html#cb12-54" tabindex="-1"></a>  bb_temp <span class="ot">&lt;-</span></span>
<span id="cb12-55"><a href="data-preparation.html#cb12-55" tabindex="-1"></a>    sf_data <span class="sc">%&gt;%</span> </span>
<span id="cb12-56"><a href="data-preparation.html#cb12-56" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-57"><a href="data-preparation.html#cb12-57" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-58"><a href="data-preparation.html#cb12-58" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">5070</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-59"><a href="data-preparation.html#cb12-59" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="fu">as.numeric</span>(buffer_box)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-60"><a href="data-preparation.html#cb12-60" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb12-61"><a href="data-preparation.html#cb12-61" tabindex="-1"></a>  </span>
<span id="cb12-62"><a href="data-preparation.html#cb12-62" tabindex="-1"></a>  center_temp <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_centroid</span>(bb_temp) <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span> .[<span class="dv">1</span>,]</span>
<span id="cb12-63"><a href="data-preparation.html#cb12-63" tabindex="-1"></a>  <span class="co"># set bbox for get call</span></span>
<span id="cb12-64"><a href="data-preparation.html#cb12-64" tabindex="-1"></a>  bb_temp <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(bb_temp)</span>
<span id="cb12-65"><a href="data-preparation.html#cb12-65" tabindex="-1"></a>  bbox_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-66"><a href="data-preparation.html#cb12-66" tabindex="-1"></a>    <span class="at">bottom =</span> bb_temp[[<span class="dv">2</span>]]</span>
<span id="cb12-67"><a href="data-preparation.html#cb12-67" tabindex="-1"></a>    , <span class="at">top =</span> bb_temp[[<span class="dv">4</span>]]</span>
<span id="cb12-68"><a href="data-preparation.html#cb12-68" tabindex="-1"></a>    , <span class="at">right =</span> bb_temp[[<span class="dv">3</span>]]</span>
<span id="cb12-69"><a href="data-preparation.html#cb12-69" tabindex="-1"></a>    , <span class="at">left =</span> bb_temp[[<span class="dv">1</span>]]</span>
<span id="cb12-70"><a href="data-preparation.html#cb12-70" tabindex="-1"></a>  )</span>
<span id="cb12-71"><a href="data-preparation.html#cb12-71" tabindex="-1"></a>  </span>
<span id="cb12-72"><a href="data-preparation.html#cb12-72" tabindex="-1"></a>  <span class="co"># ggmap::get_stadiamap vs ggmap::get_googlemap</span></span>
<span id="cb12-73"><a href="data-preparation.html#cb12-73" tabindex="-1"></a>  <span class="cf">if</span>(</span>
<span id="cb12-74"><a href="data-preparation.html#cb12-74" tabindex="-1"></a>    <span class="fu">tolower</span>(my_maptype) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;terrain&quot;</span>, <span class="st">&quot;satellite&quot;</span>, <span class="st">&quot;roadmap&quot;</span>, <span class="st">&quot;hybrid&quot;</span>)</span>
<span id="cb12-75"><a href="data-preparation.html#cb12-75" tabindex="-1"></a>  ){</span>
<span id="cb12-76"><a href="data-preparation.html#cb12-76" tabindex="-1"></a>    is_google <span class="ot">&lt;-</span> T</span>
<span id="cb12-77"><a href="data-preparation.html#cb12-77" tabindex="-1"></a>    </span>
<span id="cb12-78"><a href="data-preparation.html#cb12-78" tabindex="-1"></a>    hey_ggmap <span class="ot">&lt;-</span> ggmap<span class="sc">::</span><span class="fu">get_googlemap</span>(</span>
<span id="cb12-79"><a href="data-preparation.html#cb12-79" tabindex="-1"></a>      <span class="at">center =</span> center_temp</span>
<span id="cb12-80"><a href="data-preparation.html#cb12-80" tabindex="-1"></a>      , <span class="at">zoom =</span> zoom_level</span>
<span id="cb12-81"><a href="data-preparation.html#cb12-81" tabindex="-1"></a>      , <span class="at">maptype =</span> <span class="fu">tolower</span>(my_maptype)</span>
<span id="cb12-82"><a href="data-preparation.html#cb12-82" tabindex="-1"></a>      , <span class="at">crop =</span> T</span>
<span id="cb12-83"><a href="data-preparation.html#cb12-83" tabindex="-1"></a>    )</span>
<span id="cb12-84"><a href="data-preparation.html#cb12-84" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb12-85"><a href="data-preparation.html#cb12-85" tabindex="-1"></a>    is_google <span class="ot">&lt;-</span> F</span>
<span id="cb12-86"><a href="data-preparation.html#cb12-86" tabindex="-1"></a>    </span>
<span id="cb12-87"><a href="data-preparation.html#cb12-87" tabindex="-1"></a>    hey_ggmap <span class="ot">&lt;-</span> ggmap<span class="sc">::</span><span class="fu">get_stadiamap</span>(</span>
<span id="cb12-88"><a href="data-preparation.html#cb12-88" tabindex="-1"></a>      <span class="at">bbox =</span> bbox_temp</span>
<span id="cb12-89"><a href="data-preparation.html#cb12-89" tabindex="-1"></a>      , <span class="at">zoom =</span> zoom_level</span>
<span id="cb12-90"><a href="data-preparation.html#cb12-90" tabindex="-1"></a>      , <span class="at">maptype =</span> <span class="fu">tolower</span>(my_maptype) <span class="co">#&quot;stamen_terrain&quot; #&quot;stamen_toner_lite&quot;</span></span>
<span id="cb12-91"><a href="data-preparation.html#cb12-91" tabindex="-1"></a>      , <span class="at">crop =</span> T</span>
<span id="cb12-92"><a href="data-preparation.html#cb12-92" tabindex="-1"></a>    )</span>
<span id="cb12-93"><a href="data-preparation.html#cb12-93" tabindex="-1"></a>  </span>
<span id="cb12-94"><a href="data-preparation.html#cb12-94" tabindex="-1"></a>    <span class="co"># ggmap::ggmap(hey_ggmap)</span></span>
<span id="cb12-95"><a href="data-preparation.html#cb12-95" tabindex="-1"></a>    <span class="co"># apply align function</span></span>
<span id="cb12-96"><a href="data-preparation.html#cb12-96" tabindex="-1"></a>    hey_ggmap <span class="ot">&lt;-</span> <span class="fu">ggmap_bbox_fn</span>(hey_ggmap, my_crs) <span class="co"># Use the function</span></span>
<span id="cb12-97"><a href="data-preparation.html#cb12-97" tabindex="-1"></a>  }</span>
<span id="cb12-98"><a href="data-preparation.html#cb12-98" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb12-99"><a href="data-preparation.html#cb12-99" tabindex="-1"></a>  plt_basemap <span class="ot">&lt;-</span></span>
<span id="cb12-100"><a href="data-preparation.html#cb12-100" tabindex="-1"></a>    ggmap<span class="sc">::</span><span class="fu">ggmap</span>(hey_ggmap) <span class="sc">+</span> </span>
<span id="cb12-101"><a href="data-preparation.html#cb12-101" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">coord_sf</span>(</span>
<span id="cb12-102"><a href="data-preparation.html#cb12-102" tabindex="-1"></a>      <span class="at">expand =</span> <span class="cn">FALSE</span></span>
<span id="cb12-103"><a href="data-preparation.html#cb12-103" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb12-104"><a href="data-preparation.html#cb12-104" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb12-105"><a href="data-preparation.html#cb12-105" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb12-106"><a href="data-preparation.html#cb12-106" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb12-107"><a href="data-preparation.html#cb12-107" tabindex="-1"></a>      , <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb12-108"><a href="data-preparation.html#cb12-108" tabindex="-1"></a>      , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb12-109"><a href="data-preparation.html#cb12-109" tabindex="-1"></a>      , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb12-110"><a href="data-preparation.html#cb12-110" tabindex="-1"></a>      , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb12-111"><a href="data-preparation.html#cb12-111" tabindex="-1"></a>      , <span class="at">axis.ticks =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb12-112"><a href="data-preparation.html#cb12-112" tabindex="-1"></a>      , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb12-113"><a href="data-preparation.html#cb12-113" tabindex="-1"></a>      , <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-114"><a href="data-preparation.html#cb12-114" tabindex="-1"></a>    )</span>
<span id="cb12-115"><a href="data-preparation.html#cb12-115" tabindex="-1"></a>  </span>
<span id="cb12-116"><a href="data-preparation.html#cb12-116" tabindex="-1"></a>  <span class="do">### add data?</span></span>
<span id="cb12-117"><a href="data-preparation.html#cb12-117" tabindex="-1"></a>  <span class="cf">if</span>(scale_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;bl&quot;</span>, <span class="st">&quot;br&quot;</span>, <span class="st">&quot;tr&quot;</span>, <span class="st">&quot;tl&quot;</span>)){</span>
<span id="cb12-118"><a href="data-preparation.html#cb12-118" tabindex="-1"></a>    plt_basemap <span class="ot">&lt;-</span> plt_basemap <span class="sc">+</span> </span>
<span id="cb12-119"><a href="data-preparation.html#cb12-119" tabindex="-1"></a>      ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(</span>
<span id="cb12-120"><a href="data-preparation.html#cb12-120" tabindex="-1"></a>        <span class="at">location =</span> scale_location</span>
<span id="cb12-121"><a href="data-preparation.html#cb12-121" tabindex="-1"></a>        , <span class="at">style =</span> <span class="st">&quot;ticks&quot;</span></span>
<span id="cb12-122"><a href="data-preparation.html#cb12-122" tabindex="-1"></a>        , <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-123"><a href="data-preparation.html#cb12-123" tabindex="-1"></a>        , <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb12-124"><a href="data-preparation.html#cb12-124" tabindex="-1"></a>      )</span>
<span id="cb12-125"><a href="data-preparation.html#cb12-125" tabindex="-1"></a>  }</span>
<span id="cb12-126"><a href="data-preparation.html#cb12-126" tabindex="-1"></a>  </span>
<span id="cb12-127"><a href="data-preparation.html#cb12-127" tabindex="-1"></a>  <span class="cf">if</span>(add_sf_data){</span>
<span id="cb12-128"><a href="data-preparation.html#cb12-128" tabindex="-1"></a>    <span class="cf">if</span>(is_google){</span>
<span id="cb12-129"><a href="data-preparation.html#cb12-129" tabindex="-1"></a>      plt_basemap <span class="ot">&lt;-</span> </span>
<span id="cb12-130"><a href="data-preparation.html#cb12-130" tabindex="-1"></a>        plt_basemap <span class="sc">+</span></span>
<span id="cb12-131"><a href="data-preparation.html#cb12-131" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb12-132"><a href="data-preparation.html#cb12-132" tabindex="-1"></a>          <span class="at">data =</span> sf_data <span class="sc">%&gt;%</span> </span>
<span id="cb12-133"><a href="data-preparation.html#cb12-133" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb12-134"><a href="data-preparation.html#cb12-134" tabindex="-1"></a>          , <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> outline_sf_data_col, <span class="at">lwd =</span> outline_lwd</span>
<span id="cb12-135"><a href="data-preparation.html#cb12-135" tabindex="-1"></a>          , <span class="at">inherit.aes =</span> F</span>
<span id="cb12-136"><a href="data-preparation.html#cb12-136" tabindex="-1"></a>        )</span>
<span id="cb12-137"><a href="data-preparation.html#cb12-137" tabindex="-1"></a>        <span class="co"># ggplot2::geom_path(</span></span>
<span id="cb12-138"><a href="data-preparation.html#cb12-138" tabindex="-1"></a>        <span class="co">#   data = sf_data %&gt;% </span></span>
<span id="cb12-139"><a href="data-preparation.html#cb12-139" tabindex="-1"></a>        <span class="co">#     sf::st_transform(4326) %&gt;% </span></span>
<span id="cb12-140"><a href="data-preparation.html#cb12-140" tabindex="-1"></a>        <span class="co">#     st_coordinates() %&gt;% </span></span>
<span id="cb12-141"><a href="data-preparation.html#cb12-141" tabindex="-1"></a>        <span class="co">#     as.data.frame() %&gt;% </span></span>
<span id="cb12-142"><a href="data-preparation.html#cb12-142" tabindex="-1"></a>        <span class="co">#     dplyr::mutate(lon = X, lat = Y) %&gt;% </span></span>
<span id="cb12-143"><a href="data-preparation.html#cb12-143" tabindex="-1"></a>        <span class="co">#     sf::st_as_sf(coords = c(&quot;X&quot;,&quot;Y&quot;), crs = 4326)</span></span>
<span id="cb12-144"><a href="data-preparation.html#cb12-144" tabindex="-1"></a>        <span class="co">#   , fill = NA, color = outline_sf_data_col</span></span>
<span id="cb12-145"><a href="data-preparation.html#cb12-145" tabindex="-1"></a>        <span class="co">#   , inherit.aes = F</span></span>
<span id="cb12-146"><a href="data-preparation.html#cb12-146" tabindex="-1"></a>        <span class="co"># )</span></span>
<span id="cb12-147"><a href="data-preparation.html#cb12-147" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb12-148"><a href="data-preparation.html#cb12-148" tabindex="-1"></a>      plt_basemap <span class="ot">&lt;-</span> </span>
<span id="cb12-149"><a href="data-preparation.html#cb12-149" tabindex="-1"></a>        plt_basemap <span class="sc">+</span></span>
<span id="cb12-150"><a href="data-preparation.html#cb12-150" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb12-151"><a href="data-preparation.html#cb12-151" tabindex="-1"></a>          <span class="at">data =</span> sf_data <span class="sc">%&gt;%</span></span>
<span id="cb12-152"><a href="data-preparation.html#cb12-152" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span>plt_crs)</span>
<span id="cb12-153"><a href="data-preparation.html#cb12-153" tabindex="-1"></a>          , <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> outline_sf_data_col, <span class="at">lwd =</span> outline_lwd</span>
<span id="cb12-154"><a href="data-preparation.html#cb12-154" tabindex="-1"></a>          , <span class="at">inherit.aes =</span> F</span>
<span id="cb12-155"><a href="data-preparation.html#cb12-155" tabindex="-1"></a>        )</span>
<span id="cb12-156"><a href="data-preparation.html#cb12-156" tabindex="-1"></a>    }</span>
<span id="cb12-157"><a href="data-preparation.html#cb12-157" tabindex="-1"></a>  }</span>
<span id="cb12-158"><a href="data-preparation.html#cb12-158" tabindex="-1"></a>  </span>
<span id="cb12-159"><a href="data-preparation.html#cb12-159" tabindex="-1"></a>  <span class="fu">return</span>(plt_basemap)</span>
<span id="cb12-160"><a href="data-preparation.html#cb12-160" tabindex="-1"></a>}</span></code></pre></div>
<p>make a function specific to this data and task to grab the basemap with <code>my_ggmap_basemap()</code> and overlay the point cloud data and the study area bounds</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-preparation.html#cb13-1" tabindex="-1"></a>plt_fn_temp <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb13-2"><a href="data-preparation.html#cb13-2" tabindex="-1"></a>  record_study_sites_las_ctg</span>
<span id="cb13-3"><a href="data-preparation.html#cb13-3" tabindex="-1"></a>  , <span class="at">my_study_sites_las_ctg =</span> study_sites_las_ctg</span>
<span id="cb13-4"><a href="data-preparation.html#cb13-4" tabindex="-1"></a>  , <span class="at">my_study_sites_sf =</span> study_sites_sf</span>
<span id="cb13-5"><a href="data-preparation.html#cb13-5" tabindex="-1"></a>  <span class="co"># , zoom_level = 14, buffer_box = 2600, my_crs = plt_crs, scale_location = &quot;bl&quot;, my_maptype = &quot;stamen_terrain&quot;</span></span>
<span id="cb13-6"><a href="data-preparation.html#cb13-6" tabindex="-1"></a>) {</span>
<span id="cb13-7"><a href="data-preparation.html#cb13-7" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="data-preparation.html#cb13-8" tabindex="-1"></a>  <span class="co"># make a function to grab the basemap with my_ggmap_basemap, and overlay the point cloud data and the study area bounds</span></span>
<span id="cb13-9"><a href="data-preparation.html#cb13-9" tabindex="-1"></a>  plt_basemap_temp <span class="ot">&lt;-</span> <span class="fu">my_ggmap_basemap</span>(</span>
<span id="cb13-10"><a href="data-preparation.html#cb13-10" tabindex="-1"></a>    <span class="at">sf_data =</span> my_study_sites_las_ctg[[record_study_sites_las_ctg]]<span class="sc">$</span>geometry</span>
<span id="cb13-11"><a href="data-preparation.html#cb13-11" tabindex="-1"></a>    , <span class="at">zoom_level =</span> <span class="dv">14</span></span>
<span id="cb13-12"><a href="data-preparation.html#cb13-12" tabindex="-1"></a>    , <span class="at">buffer_box =</span> <span class="dv">3333</span></span>
<span id="cb13-13"><a href="data-preparation.html#cb13-13" tabindex="-1"></a>    , <span class="at">my_crs =</span> plt_crs</span>
<span id="cb13-14"><a href="data-preparation.html#cb13-14" tabindex="-1"></a>    , <span class="at">scale_location =</span> <span class="st">&quot;bl&quot;</span></span>
<span id="cb13-15"><a href="data-preparation.html#cb13-15" tabindex="-1"></a>    , <span class="at">my_maptype =</span> <span class="st">&quot;stamen_terrain&quot;</span></span>
<span id="cb13-16"><a href="data-preparation.html#cb13-16" tabindex="-1"></a>  )</span>
<span id="cb13-17"><a href="data-preparation.html#cb13-17" tabindex="-1"></a>  </span>
<span id="cb13-18"><a href="data-preparation.html#cb13-18" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb13-19"><a href="data-preparation.html#cb13-19" tabindex="-1"></a>  plt2_temp <span class="ot">&lt;-</span></span>
<span id="cb13-20"><a href="data-preparation.html#cb13-20" tabindex="-1"></a>    plt_basemap_temp <span class="sc">+</span> </span>
<span id="cb13-21"><a href="data-preparation.html#cb13-21" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb13-22"><a href="data-preparation.html#cb13-22" tabindex="-1"></a>        <span class="at">data =</span> </span>
<span id="cb13-23"><a href="data-preparation.html#cb13-23" tabindex="-1"></a>          my_study_sites_las_ctg[[record_study_sites_las_ctg]]<span class="sc">$</span>geometry <span class="sc">%&gt;%</span></span>
<span id="cb13-24"><a href="data-preparation.html#cb13-24" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span>plt_crs)</span>
<span id="cb13-25"><a href="data-preparation.html#cb13-25" tabindex="-1"></a>        , <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray8&quot;</span></span>
<span id="cb13-26"><a href="data-preparation.html#cb13-26" tabindex="-1"></a>        , <span class="at">inherit.aes =</span> F</span>
<span id="cb13-27"><a href="data-preparation.html#cb13-27" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb13-28"><a href="data-preparation.html#cb13-28" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb13-29"><a href="data-preparation.html#cb13-29" tabindex="-1"></a>        <span class="at">data =</span> my_study_sites_sf <span class="sc">%&gt;%</span> </span>
<span id="cb13-30"><a href="data-preparation.html#cb13-30" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb13-31"><a href="data-preparation.html#cb13-31" tabindex="-1"></a>            study_site <span class="sc">%in%</span> (my_study_sites_las_ctg[record_study_sites_las_ctg] <span class="sc">%&gt;%</span> </span>
<span id="cb13-32"><a href="data-preparation.html#cb13-32" tabindex="-1"></a>              <span class="fu">names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-33"><a href="data-preparation.html#cb13-33" tabindex="-1"></a>              stringr<span class="sc">::</span><span class="fu">word</span>(<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb13-34"><a href="data-preparation.html#cb13-34" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-35"><a href="data-preparation.html#cb13-35" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span>plt_crs)</span>
<span id="cb13-36"><a href="data-preparation.html#cb13-36" tabindex="-1"></a>        , <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.4</span></span>
<span id="cb13-37"><a href="data-preparation.html#cb13-37" tabindex="-1"></a>        , <span class="at">inherit.aes =</span> F</span>
<span id="cb13-38"><a href="data-preparation.html#cb13-38" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb13-39"><a href="data-preparation.html#cb13-39" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb13-40"><a href="data-preparation.html#cb13-40" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb13-41"><a href="data-preparation.html#cb13-41" tabindex="-1"></a>          my_study_sites_sf <span class="sc">%&gt;%</span> </span>
<span id="cb13-42"><a href="data-preparation.html#cb13-42" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb13-43"><a href="data-preparation.html#cb13-43" tabindex="-1"></a>            study_site <span class="sc">%in%</span> (my_study_sites_las_ctg[record_study_sites_las_ctg] <span class="sc">%&gt;%</span> </span>
<span id="cb13-44"><a href="data-preparation.html#cb13-44" tabindex="-1"></a>              <span class="fu">names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-45"><a href="data-preparation.html#cb13-45" tabindex="-1"></a>              stringr<span class="sc">::</span><span class="fu">word</span>(<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb13-46"><a href="data-preparation.html#cb13-46" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-47"><a href="data-preparation.html#cb13-47" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">pull</span>(study_site_lab)</span>
<span id="cb13-48"><a href="data-preparation.html#cb13-48" tabindex="-1"></a>          , <span class="st">&quot; - &quot;</span></span>
<span id="cb13-49"><a href="data-preparation.html#cb13-49" tabindex="-1"></a>          , (my_study_sites_las_ctg[record_study_sites_las_ctg] <span class="sc">%&gt;%</span> </span>
<span id="cb13-50"><a href="data-preparation.html#cb13-50" tabindex="-1"></a>              <span class="fu">names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-51"><a href="data-preparation.html#cb13-51" tabindex="-1"></a>              stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>,<span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-52"><a href="data-preparation.html#cb13-52" tabindex="-1"></a>              stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">S+</span><span class="sc">\\</span><span class="st">s*&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-53"><a href="data-preparation.html#cb13-53" tabindex="-1"></a>              <span class="fu">toupper</span>()</span>
<span id="cb13-54"><a href="data-preparation.html#cb13-54" tabindex="-1"></a>            )</span>
<span id="cb13-55"><a href="data-preparation.html#cb13-55" tabindex="-1"></a>          , <span class="st">&quot; data&quot;</span></span>
<span id="cb13-56"><a href="data-preparation.html#cb13-56" tabindex="-1"></a>        )</span>
<span id="cb13-57"><a href="data-preparation.html#cb13-57" tabindex="-1"></a>      )</span>
<span id="cb13-58"><a href="data-preparation.html#cb13-58" tabindex="-1"></a>    </span>
<span id="cb13-59"><a href="data-preparation.html#cb13-59" tabindex="-1"></a>  <span class="fu">return</span>( plt2_temp )</span>
<span id="cb13-60"><a href="data-preparation.html#cb13-60" tabindex="-1"></a>}</span>
<span id="cb13-61"><a href="data-preparation.html#cb13-61" tabindex="-1"></a><span class="co"># for each las ctg with crs</span></span>
<span id="cb13-62"><a href="data-preparation.html#cb13-62" tabindex="-1"></a>plts_temp <span class="ot">&lt;-</span> </span>
<span id="cb13-63"><a href="data-preparation.html#cb13-63" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(study_sites_las_ctg <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">discard</span>(<span class="fu">names</span>(.) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;FortStewart_uas_lidar&quot;</span>,<span class="st">&quot;NewJersey_als&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-64"><a href="data-preparation.html#cb13-64" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb13-65"><a href="data-preparation.html#cb13-65" tabindex="-1"></a>    \(x)</span>
<span id="cb13-66"><a href="data-preparation.html#cb13-66" tabindex="-1"></a>    <span class="fu">plt_fn_temp</span>(</span>
<span id="cb13-67"><a href="data-preparation.html#cb13-67" tabindex="-1"></a>      <span class="at">record_study_sites_las_ctg =</span> x</span>
<span id="cb13-68"><a href="data-preparation.html#cb13-68" tabindex="-1"></a>      , <span class="at">my_study_sites_las_ctg =</span> study_sites_las_ctg <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">discard</span>(<span class="fu">names</span>(.) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;FortStewart_uas_lidar&quot;</span>,<span class="st">&quot;NewJersey_als&quot;</span>))</span>
<span id="cb13-69"><a href="data-preparation.html#cb13-69" tabindex="-1"></a>      , </span>
<span id="cb13-70"><a href="data-preparation.html#cb13-70" tabindex="-1"></a>    )</span>
<span id="cb13-71"><a href="data-preparation.html#cb13-71" tabindex="-1"></a>  )</span>
<span id="cb13-72"><a href="data-preparation.html#cb13-72" tabindex="-1"></a><span class="co"># patchwork it</span></span>
<span id="cb13-73"><a href="data-preparation.html#cb13-73" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(plts_temp, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb13-74"><a href="data-preparation.html#cb13-74" tabindex="-1"></a><span class="co"># </span></span></code></pre></div>
</div>
<div id="itd-window-functions" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> ITD window functions<a href="data-preparation.html#itd-window-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-preparation.html#cb14-1" tabindex="-1"></a><span class="co"># set up initial list with default functions</span></span>
<span id="cb14-2"><a href="data-preparation.html#cb14-2" tabindex="-1"></a>my_ws_functions <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">itd_ws_functions</span>()</span>
<span id="cb14-3"><a href="data-preparation.html#cb14-3" tabindex="-1"></a><span class="co"># add to list</span></span>
<span id="cb14-4"><a href="data-preparation.html#cb14-4" tabindex="-1"></a>my_ws_functions<span class="sc">$</span>log_les_ccv_fn <span class="ot">&lt;-</span> <span class="cf">function</span> (x) {</span>
<span id="cb14-5"><a href="data-preparation.html#cb14-5" tabindex="-1"></a>    y <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb14-6"><a href="data-preparation.html#cb14-6" tabindex="-1"></a>      <span class="fu">is.na</span>(x) <span class="sc">~</span> <span class="fl">0.001</span></span>
<span id="cb14-7"><a href="data-preparation.html#cb14-7" tabindex="-1"></a>      , x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fl">0.001</span></span>
<span id="cb14-8"><a href="data-preparation.html#cb14-8" tabindex="-1"></a>      , x <span class="sc">&gt;</span> <span class="fu">exp</span>(<span class="dv">5</span>)<span class="sc">-</span><span class="dv">1</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb14-9"><a href="data-preparation.html#cb14-9" tabindex="-1"></a>      , <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">log</span>(x<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb14-10"><a href="data-preparation.html#cb14-10" tabindex="-1"></a>    )</span>
<span id="cb14-11"><a href="data-preparation.html#cb14-11" tabindex="-1"></a>    <span class="fu">return</span>(y)</span>
<span id="cb14-12"><a href="data-preparation.html#cb14-12" tabindex="-1"></a>}</span>
<span id="cb14-13"><a href="data-preparation.html#cb14-13" tabindex="-1"></a><span class="co"># add to list</span></span>
<span id="cb14-14"><a href="data-preparation.html#cb14-14" tabindex="-1"></a>my_ws_functions<span class="sc">$</span>log_mor_ccv_fn <span class="ot">&lt;-</span> <span class="cf">function</span> (x) {</span>
<span id="cb14-15"><a href="data-preparation.html#cb14-15" tabindex="-1"></a>    y <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb14-16"><a href="data-preparation.html#cb14-16" tabindex="-1"></a>      <span class="fu">is.na</span>(x) <span class="sc">~</span> <span class="fl">0.001</span></span>
<span id="cb14-17"><a href="data-preparation.html#cb14-17" tabindex="-1"></a>      , x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fl">0.001</span></span>
<span id="cb14-18"><a href="data-preparation.html#cb14-18" tabindex="-1"></a>      , x <span class="sc">&gt;</span> <span class="fu">exp</span>(<span class="dv">7</span><span class="sc">/</span><span class="fl">1.5</span>)<span class="sc">-</span><span class="dv">1</span> <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb14-19"><a href="data-preparation.html#cb14-19" tabindex="-1"></a>      , <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fl">1.5</span><span class="sc">*</span><span class="fu">log</span>(x<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb14-20"><a href="data-preparation.html#cb14-20" tabindex="-1"></a>    )</span>
<span id="cb14-21"><a href="data-preparation.html#cb14-21" tabindex="-1"></a>    <span class="fu">return</span>(y)</span>
<span id="cb14-22"><a href="data-preparation.html#cb14-22" tabindex="-1"></a>}</span>
<span id="cb14-23"><a href="data-preparation.html#cb14-23" tabindex="-1"></a><span class="co"># add to list</span></span>
<span id="cb14-24"><a href="data-preparation.html#cb14-24" tabindex="-1"></a>my_ws_functions<span class="sc">$</span>lin_lo_slp_fn <span class="ot">&lt;-</span> <span class="cf">function</span> (x) {</span>
<span id="cb14-25"><a href="data-preparation.html#cb14-25" tabindex="-1"></a>    y <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb14-26"><a href="data-preparation.html#cb14-26" tabindex="-1"></a>      <span class="fu">is.na</span>(x) <span class="sc">~</span> <span class="fl">0.001</span></span>
<span id="cb14-27"><a href="data-preparation.html#cb14-27" tabindex="-1"></a>      , x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fl">0.001</span></span>
<span id="cb14-28"><a href="data-preparation.html#cb14-28" tabindex="-1"></a>      , x <span class="sc">&gt;</span> (<span class="dv">4</span><span class="fl">-0.75</span>)<span class="sc">/</span><span class="fl">0.04</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb14-29"><a href="data-preparation.html#cb14-29" tabindex="-1"></a>      , <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fl">0.75</span> <span class="sc">+</span> (x <span class="sc">*</span> <span class="fl">0.04</span>)</span>
<span id="cb14-30"><a href="data-preparation.html#cb14-30" tabindex="-1"></a>    )</span>
<span id="cb14-31"><a href="data-preparation.html#cb14-31" tabindex="-1"></a>    <span class="fu">return</span>(y)</span>
<span id="cb14-32"><a href="data-preparation.html#cb14-32" tabindex="-1"></a>}</span></code></pre></div>
<p>run each function over a range of heights to see what they return on a plot</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-preparation.html#cb15-1" tabindex="-1"></a><span class="co"># get ws by ht for each fn</span></span>
<span id="cb15-2"><a href="data-preparation.html#cb15-2" tabindex="-1"></a>ws_fn_df <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(my_ws_functions) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="data-preparation.html#cb15-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb15-4"><a href="data-preparation.html#cb15-4" tabindex="-1"></a>    nm <span class="ot">&lt;-</span> my_ws_functions[x] <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()</span>
<span id="cb15-5"><a href="data-preparation.html#cb15-5" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> my_ws_functions[[x]]</span>
<span id="cb15-6"><a href="data-preparation.html#cb15-6" tabindex="-1"></a>    <span class="co"># est</span></span>
<span id="cb15-7"><a href="data-preparation.html#cb15-7" tabindex="-1"></a>    height <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="dv">60</span>,<span class="at">by=</span><span class="fl">0.5</span>)</span>
<span id="cb15-8"><a href="data-preparation.html#cb15-8" tabindex="-1"></a>    ws <span class="ot">&lt;-</span> <span class="fu">fn</span>(height) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span>
<span id="cb15-9"><a href="data-preparation.html#cb15-9" tabindex="-1"></a>    df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb15-10"><a href="data-preparation.html#cb15-10" tabindex="-1"></a>        <span class="at">height =</span> height</span>
<span id="cb15-11"><a href="data-preparation.html#cb15-11" tabindex="-1"></a>        , <span class="at">ws =</span> ws</span>
<span id="cb15-12"><a href="data-preparation.html#cb15-12" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-13"><a href="data-preparation.html#cb15-13" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ws_fn_nm =</span> nm) <span class="sc">%&gt;%</span> </span>
<span id="cb15-14"><a href="data-preparation.html#cb15-14" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">relocate</span>(ws_fn_nm)</span>
<span id="cb15-15"><a href="data-preparation.html#cb15-15" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb15-16"><a href="data-preparation.html#cb15-16" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="data-preparation.html#cb15-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb15-18"><a href="data-preparation.html#cb15-18" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb15-19"><a href="data-preparation.html#cb15-19" tabindex="-1"></a>ws_fn_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 726
## Columns: 3
## $ ws_fn_nm &lt;chr&gt; &quot;lin_fn&quot;, &quot;lin_fn&quot;, &quot;lin_fn&quot;, &quot;lin_fn&quot;, &quot;lin_fn&quot;, &quot;lin_fn&quot;, &quot;…
## $ height   &lt;dbl&gt; 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 5.5, 6…
## $ ws       &lt;dbl&gt; 1.00, 1.00, 1.00, 1.00, 1.03, 1.10, 1.17, 1.24, 1.31, 1.38, 1…</code></pre>
<p>plot of all ITD variable window functions for testing</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-preparation.html#cb17-1" tabindex="-1"></a>ws_fn_df <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="data-preparation.html#cb17-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> ws, <span class="at">color =</span> ws_fn_nm)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="data-preparation.html#cb17-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="data-preparation.html#cb17-4" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_manual(values = pal_ws) +</span></span>
<span id="cb17-5"><a href="data-preparation.html#cb17-5" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(option = &quot;turbo&quot;) +</span></span>
<span id="cb17-6"><a href="data-preparation.html#cb17-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-7"><a href="data-preparation.html#cb17-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="data-preparation.html#cb17-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">0.1</span>,<span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="data-preparation.html#cb17-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb17-10"><a href="data-preparation.html#cb17-10" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;heights&quot;</span>, <span class="at">y =</span> <span class="st">&quot;ws&quot;</span></span>
<span id="cb17-11"><a href="data-preparation.html#cb17-11" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;variable</span><span class="sc">\n</span><span class="st">window</span><span class="sc">\n</span><span class="st">function&quot;</span></span>
<span id="cb17-12"><a href="data-preparation.html#cb17-12" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;ITD variable window functions for testing&quot;</span></span>
<span id="cb17-13"><a href="data-preparation.html#cb17-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-14"><a href="data-preparation.html#cb17-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb17-15"><a href="data-preparation.html#cb17-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb17-16"><a href="data-preparation.html#cb17-16" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">lwd =</span> <span class="dv">6</span>))</span>
<span id="cb17-17"><a href="data-preparation.html#cb17-17" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="dod_cloud2trees_demo_files/figure-html/unnamed-chunk-18-1.png" width="1008" /></p>
</div>
<div id="other-plotting-functions" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Other plotting functions<a href="data-preparation.html#other-plotting-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>function to plot raster with vector data overlaid</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-preparation.html#cb18-1" tabindex="-1"></a>plt_rast_poly_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb18-2"><a href="data-preparation.html#cb18-2" tabindex="-1"></a>  rast</span>
<span id="cb18-3"><a href="data-preparation.html#cb18-3" tabindex="-1"></a>  , poly</span>
<span id="cb18-4"><a href="data-preparation.html#cb18-4" tabindex="-1"></a>  , <span class="at">crop =</span> T</span>
<span id="cb18-5"><a href="data-preparation.html#cb18-5" tabindex="-1"></a>  , <span class="at">mask =</span> F</span>
<span id="cb18-6"><a href="data-preparation.html#cb18-6" tabindex="-1"></a>  , <span class="at">buff =</span> <span class="dv">22</span></span>
<span id="cb18-7"><a href="data-preparation.html#cb18-7" tabindex="-1"></a>  , <span class="at">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb18-8"><a href="data-preparation.html#cb18-8" tabindex="-1"></a>  , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb18-9"><a href="data-preparation.html#cb18-9" tabindex="-1"></a>  , <span class="at">title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb18-10"><a href="data-preparation.html#cb18-10" tabindex="-1"></a>  , <span class="at">leg_pos =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb18-11"><a href="data-preparation.html#cb18-11" tabindex="-1"></a>) {</span>
<span id="cb18-12"><a href="data-preparation.html#cb18-12" tabindex="-1"></a>  <span class="cf">if</span>(crop){</span>
<span id="cb18-13"><a href="data-preparation.html#cb18-13" tabindex="-1"></a>    rast <span class="ot">&lt;-</span> rast <span class="sc">%&gt;%</span> </span>
<span id="cb18-14"><a href="data-preparation.html#cb18-14" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb18-15"><a href="data-preparation.html#cb18-15" tabindex="-1"></a>        poly <span class="sc">%&gt;%</span> </span>
<span id="cb18-16"><a href="data-preparation.html#cb18-16" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_buffer</span>(buff) <span class="sc">%&gt;%</span> </span>
<span id="cb18-17"><a href="data-preparation.html#cb18-17" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-18"><a href="data-preparation.html#cb18-18" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb18-19"><a href="data-preparation.html#cb18-19" tabindex="-1"></a>      )</span>
<span id="cb18-20"><a href="data-preparation.html#cb18-20" tabindex="-1"></a>  }</span>
<span id="cb18-21"><a href="data-preparation.html#cb18-21" tabindex="-1"></a>  <span class="cf">if</span>(mask){</span>
<span id="cb18-22"><a href="data-preparation.html#cb18-22" tabindex="-1"></a>    rast <span class="ot">&lt;-</span> rast <span class="sc">%&gt;%</span> </span>
<span id="cb18-23"><a href="data-preparation.html#cb18-23" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb18-24"><a href="data-preparation.html#cb18-24" tabindex="-1"></a>        poly <span class="sc">%&gt;%</span> </span>
<span id="cb18-25"><a href="data-preparation.html#cb18-25" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_buffer</span>(buff) <span class="sc">%&gt;%</span> </span>
<span id="cb18-26"><a href="data-preparation.html#cb18-26" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-27"><a href="data-preparation.html#cb18-27" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb18-28"><a href="data-preparation.html#cb18-28" tabindex="-1"></a>      )</span>
<span id="cb18-29"><a href="data-preparation.html#cb18-29" tabindex="-1"></a>  }</span>
<span id="cb18-30"><a href="data-preparation.html#cb18-30" tabindex="-1"></a>  </span>
<span id="cb18-31"><a href="data-preparation.html#cb18-31" tabindex="-1"></a>  <span class="co"># Convert SpatRaster to a data frame for ggplot</span></span>
<span id="cb18-32"><a href="data-preparation.html#cb18-32" tabindex="-1"></a>  rast_df <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">as.data.frame</span>(rast, <span class="at">xy=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>)</span>
<span id="cb18-33"><a href="data-preparation.html#cb18-33" tabindex="-1"></a></span>
<span id="cb18-34"><a href="data-preparation.html#cb18-34" tabindex="-1"></a>  <span class="co"># Create the base raster plot</span></span>
<span id="cb18-35"><a href="data-preparation.html#cb18-35" tabindex="-1"></a>  p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-36"><a href="data-preparation.html#cb18-36" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_raster</span>(</span>
<span id="cb18-37"><a href="data-preparation.html#cb18-37" tabindex="-1"></a>      <span class="at">data =</span> rast_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> f)</span>
<span id="cb18-38"><a href="data-preparation.html#cb18-38" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb18-39"><a href="data-preparation.html#cb18-39" tabindex="-1"></a>    <span class="co"># ggplot2::scale_fill_viridis_c() + # Use a colorblind-friendly palette</span></span>
<span id="cb18-40"><a href="data-preparation.html#cb18-40" tabindex="-1"></a>    <span class="co"># ggplot2::coord_sf(crs = terra::crs(rast)) +  # Match the CRS</span></span>
<span id="cb18-41"><a href="data-preparation.html#cb18-41" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-42"><a href="data-preparation.html#cb18-42" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb18-43"><a href="data-preparation.html#cb18-43" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb18-44"><a href="data-preparation.html#cb18-44" tabindex="-1"></a>      <span class="at">legend.position =</span> leg_pos</span>
<span id="cb18-45"><a href="data-preparation.html#cb18-45" tabindex="-1"></a>      , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb18-46"><a href="data-preparation.html#cb18-46" tabindex="-1"></a>      , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb18-47"><a href="data-preparation.html#cb18-47" tabindex="-1"></a>      <span class="co"># , plot.title = ggplot2::element_text(hjust = 0.5)</span></span>
<span id="cb18-48"><a href="data-preparation.html#cb18-48" tabindex="-1"></a>    )</span>
<span id="cb18-49"><a href="data-preparation.html#cb18-49" tabindex="-1"></a></span>
<span id="cb18-50"><a href="data-preparation.html#cb18-50" tabindex="-1"></a>  <span class="co"># Add the polygon overlay</span></span>
<span id="cb18-51"><a href="data-preparation.html#cb18-51" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb18-52"><a href="data-preparation.html#cb18-52" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb18-53"><a href="data-preparation.html#cb18-53" tabindex="-1"></a>      <span class="at">data =</span> poly <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb18-54"><a href="data-preparation.html#cb18-54" tabindex="-1"></a>      , <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> col, <span class="at">lwd =</span> lwd</span>
<span id="cb18-55"><a href="data-preparation.html#cb18-55" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb18-56"><a href="data-preparation.html#cb18-56" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> title)</span>
<span id="cb18-57"><a href="data-preparation.html#cb18-57" tabindex="-1"></a></span>
<span id="cb18-58"><a href="data-preparation.html#cb18-58" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb18-59"><a href="data-preparation.html#cb18-59" tabindex="-1"></a>}</span>
<span id="cb18-60"><a href="data-preparation.html#cb18-60" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb18-61"><a href="data-preparation.html#cb18-61" tabindex="-1"></a>plt_crown_attr_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb18-62"><a href="data-preparation.html#cb18-62" tabindex="-1"></a>  crowns</span>
<span id="cb18-63"><a href="data-preparation.html#cb18-63" tabindex="-1"></a>  , aoi</span>
<span id="cb18-64"><a href="data-preparation.html#cb18-64" tabindex="-1"></a>  , <span class="at">col =</span> <span class="st">&quot;navy&quot;</span></span>
<span id="cb18-65"><a href="data-preparation.html#cb18-65" tabindex="-1"></a>  , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb18-66"><a href="data-preparation.html#cb18-66" tabindex="-1"></a>  , <span class="at">title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb18-67"><a href="data-preparation.html#cb18-67" tabindex="-1"></a>  , <span class="at">leg_pos =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb18-68"><a href="data-preparation.html#cb18-68" tabindex="-1"></a>  <span class="co"># polygon attrs</span></span>
<span id="cb18-69"><a href="data-preparation.html#cb18-69" tabindex="-1"></a>  , fill_var</span>
<span id="cb18-70"><a href="data-preparation.html#cb18-70" tabindex="-1"></a>  , <span class="at">palette =</span> <span class="st">&quot;Blues&quot;</span> <span class="co"># see ggplot2::scale_fill_distiller</span></span>
<span id="cb18-71"><a href="data-preparation.html#cb18-71" tabindex="-1"></a>) {</span>
<span id="cb18-72"><a href="data-preparation.html#cb18-72" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb18-73"><a href="data-preparation.html#cb18-73" tabindex="-1"></a>    <span class="at">data =</span> aoi <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(crowns))</span>
<span id="cb18-74"><a href="data-preparation.html#cb18-74" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb18-75"><a href="data-preparation.html#cb18-75" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> col, <span class="at">lwd =</span> lwd) <span class="sc">+</span></span>
<span id="cb18-76"><a href="data-preparation.html#cb18-76" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb18-77"><a href="data-preparation.html#cb18-77" tabindex="-1"></a>    <span class="at">data =</span> crowns <span class="sc">%&gt;%</span> </span>
<span id="cb18-78"><a href="data-preparation.html#cb18-78" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb18-79"><a href="data-preparation.html#cb18-79" tabindex="-1"></a>        aoi <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(crowns))</span>
<span id="cb18-80"><a href="data-preparation.html#cb18-80" tabindex="-1"></a>      )</span>
<span id="cb18-81"><a href="data-preparation.html#cb18-81" tabindex="-1"></a>    , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> .data[[fill_var]])</span>
<span id="cb18-82"><a href="data-preparation.html#cb18-82" tabindex="-1"></a>    , <span class="at">color =</span> <span class="cn">NA</span></span>
<span id="cb18-83"><a href="data-preparation.html#cb18-83" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb18-84"><a href="data-preparation.html#cb18-84" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> palette, <span class="at">name =</span> title, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb18-85"><a href="data-preparation.html#cb18-85" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb18-86"><a href="data-preparation.html#cb18-86" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb18-87"><a href="data-preparation.html#cb18-87" tabindex="-1"></a>    <span class="at">legend.position =</span> leg_pos</span>
<span id="cb18-88"><a href="data-preparation.html#cb18-88" tabindex="-1"></a>    , <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb18-89"><a href="data-preparation.html#cb18-89" tabindex="-1"></a>    , <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb18-90"><a href="data-preparation.html#cb18-90" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb18-91"><a href="data-preparation.html#cb18-91" tabindex="-1"></a>  )</span>
<span id="cb18-92"><a href="data-preparation.html#cb18-92" tabindex="-1"></a>}</span>
<span id="cb18-93"><a href="data-preparation.html#cb18-93" tabindex="-1"></a><span class="co"># load our FIA forest type group raster for use later</span></span>
<span id="cb18-94"><a href="data-preparation.html#cb18-94" tabindex="-1"></a><span class="co"># load lookup</span></span>
<span id="cb18-95"><a href="data-preparation.html#cb18-95" tabindex="-1"></a>  foresttype_lookup <span class="ot">&lt;-</span> <span class="fu">file.path</span>(cloud2trees<span class="sc">::</span><span class="fu">find_ext_data</span>()[[<span class="st">&quot;foresttype_dir&quot;</span>]], <span class="st">&quot;foresttype_lookup.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-96"><a href="data-preparation.html#cb18-96" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">progress =</span> F, <span class="at">show_col_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb18-97"><a href="data-preparation.html#cb18-97" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(forest_type_group_code, forest_type_group, hardwood_softwood) <span class="sc">%&gt;%</span> </span>
<span id="cb18-98"><a href="data-preparation.html#cb18-98" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">forest_type_group =</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(forest_type_group, <span class="st">&quot; group&quot;</span>))</span>
<span id="cb18-99"><a href="data-preparation.html#cb18-99" tabindex="-1"></a>  </span>
<span id="cb18-100"><a href="data-preparation.html#cb18-100" tabindex="-1"></a><span class="co"># forest type group summary</span></span>
<span id="cb18-101"><a href="data-preparation.html#cb18-101" tabindex="-1"></a>foresttype_sum_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(crowns, aoi, unit) {</span>
<span id="cb18-102"><a href="data-preparation.html#cb18-102" tabindex="-1"></a>  crowns <span class="sc">%&gt;%</span> </span>
<span id="cb18-103"><a href="data-preparation.html#cb18-103" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb18-104"><a href="data-preparation.html#cb18-104" tabindex="-1"></a>      aoi <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(crowns))</span>
<span id="cb18-105"><a href="data-preparation.html#cb18-105" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-106"><a href="data-preparation.html#cb18-106" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-107"><a href="data-preparation.html#cb18-107" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">unit_name =</span> unit) <span class="sc">%&gt;%</span> </span>
<span id="cb18-108"><a href="data-preparation.html#cb18-108" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-109"><a href="data-preparation.html#cb18-109" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(unit_name, forest_type_group) <span class="sc">%&gt;%</span> </span>
<span id="cb18-110"><a href="data-preparation.html#cb18-110" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(unit_name, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-111"><a href="data-preparation.html#cb18-111" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(unit_name) <span class="sc">%&gt;%</span> </span>
<span id="cb18-112"><a href="data-preparation.html#cb18-112" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb18-113"><a href="data-preparation.html#cb18-113" tabindex="-1"></a>      <span class="at">pct =</span> scales<span class="sc">::</span><span class="fu">percent</span>(n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">accuracy =</span> <span class="fl">0.1</span>) </span>
<span id="cb18-114"><a href="data-preparation.html#cb18-114" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-115"><a href="data-preparation.html#cb18-115" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-116"><a href="data-preparation.html#cb18-116" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-117"><a href="data-preparation.html#cb18-117" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb18-118"><a href="data-preparation.html#cb18-118" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Count of trees by FIA Forest Type Group&quot;</span></span>
<span id="cb18-119"><a href="data-preparation.html#cb18-119" tabindex="-1"></a>      , <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb18-120"><a href="data-preparation.html#cb18-120" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb18-121"><a href="data-preparation.html#cb18-121" tabindex="-1"></a>        <span class="st">&quot;.&quot;</span></span>
<span id="cb18-122"><a href="data-preparation.html#cb18-122" tabindex="-1"></a>        , <span class="st">&quot;&quot;</span></span>
<span id="cb18-123"><a href="data-preparation.html#cb18-123" tabindex="-1"></a>        , <span class="st">&quot;# trees&quot;</span></span>
<span id="cb18-124"><a href="data-preparation.html#cb18-124" tabindex="-1"></a>        , <span class="st">&quot;% trees&quot;</span></span>
<span id="cb18-125"><a href="data-preparation.html#cb18-125" tabindex="-1"></a>      )</span>
<span id="cb18-126"><a href="data-preparation.html#cb18-126" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-127"><a href="data-preparation.html#cb18-127" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-128"><a href="data-preparation.html#cb18-128" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb18-129"><a href="data-preparation.html#cb18-129" tabindex="-1"></a>}</span>
<span id="cb18-130"><a href="data-preparation.html#cb18-130" tabindex="-1"></a></span>
<span id="cb18-131"><a href="data-preparation.html#cb18-131" tabindex="-1"></a><span class="co"># summarize tree metrics</span></span>
<span id="cb18-132"><a href="data-preparation.html#cb18-132" tabindex="-1"></a>stats_sum_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(crowns, aoi, unit) {</span>
<span id="cb18-133"><a href="data-preparation.html#cb18-133" tabindex="-1"></a>  crowns <span class="sc">%&gt;%</span> </span>
<span id="cb18-134"><a href="data-preparation.html#cb18-134" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb18-135"><a href="data-preparation.html#cb18-135" tabindex="-1"></a>      aoi <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(crowns))</span>
<span id="cb18-136"><a href="data-preparation.html#cb18-136" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-137"><a href="data-preparation.html#cb18-137" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-138"><a href="data-preparation.html#cb18-138" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">unit_name =</span> unit) <span class="sc">%&gt;%</span> </span>
<span id="cb18-139"><a href="data-preparation.html#cb18-139" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>( unit_name) <span class="sc">%&gt;%</span></span>
<span id="cb18-140"><a href="data-preparation.html#cb18-140" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb18-141"><a href="data-preparation.html#cb18-141" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb18-142"><a href="data-preparation.html#cb18-142" tabindex="-1"></a>        <span class="fu">c</span>(tree_height_m, dbh_cm, tree_cbh_m, max_crown_diam_height_m, cruz_tree_kg_per_m3, landfire_tree_kg_per_m3)</span>
<span id="cb18-143"><a href="data-preparation.html#cb18-143" tabindex="-1"></a>        , <span class="at">.fns =</span> <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">median =</span> median, <span class="at">sd =</span> sd, <span class="at">min =</span> min, <span class="at">max =</span> max)</span>
<span id="cb18-144"><a href="data-preparation.html#cb18-144" tabindex="-1"></a>      )</span>
<span id="cb18-145"><a href="data-preparation.html#cb18-145" tabindex="-1"></a>      , <span class="at">n =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()</span>
<span id="cb18-146"><a href="data-preparation.html#cb18-146" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-147"><a href="data-preparation.html#cb18-147" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-148"><a href="data-preparation.html#cb18-148" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>( unit_name,n)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-149"><a href="data-preparation.html#cb18-149" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb18-150"><a href="data-preparation.html#cb18-150" tabindex="-1"></a>      <span class="at">agg =</span> stringr<span class="sc">::</span><span class="fu">word</span>(name,<span class="sc">-</span><span class="dv">1</span>,<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb18-151"><a href="data-preparation.html#cb18-151" tabindex="-1"></a>      , <span class="at">metric =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(name, <span class="fu">paste0</span>(<span class="st">&quot;_&quot;</span>,agg))</span>
<span id="cb18-152"><a href="data-preparation.html#cb18-152" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-153"><a href="data-preparation.html#cb18-153" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb18-154"><a href="data-preparation.html#cb18-154" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb18-155"><a href="data-preparation.html#cb18-155" tabindex="-1"></a>      <span class="at">value =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb18-156"><a href="data-preparation.html#cb18-156" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;tree_height_m&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb18-157"><a href="data-preparation.html#cb18-157" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;dbh_cm&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb18-158"><a href="data-preparation.html#cb18-158" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;tree_cbh_m&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb18-159"><a href="data-preparation.html#cb18-159" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;max_crown_diam_height_m&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb18-160"><a href="data-preparation.html#cb18-160" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;cruz_tree_kg_per_m3&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.001</span>)</span>
<span id="cb18-161"><a href="data-preparation.html#cb18-161" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;landfire_tree_kg_per_m3&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.001</span>)</span>
<span id="cb18-162"><a href="data-preparation.html#cb18-162" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb18-163"><a href="data-preparation.html#cb18-163" tabindex="-1"></a>      )</span>
<span id="cb18-164"><a href="data-preparation.html#cb18-164" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-165"><a href="data-preparation.html#cb18-165" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agg, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb18-166"><a href="data-preparation.html#cb18-166" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb18-167"><a href="data-preparation.html#cb18-167" tabindex="-1"></a>      <span class="at">unit_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb18-168"><a href="data-preparation.html#cb18-168" tabindex="-1"></a>        unit_name</span>
<span id="cb18-169"><a href="data-preparation.html#cb18-169" tabindex="-1"></a>        ,<span class="st">&quot;&lt;br&gt;(&quot;</span></span>
<span id="cb18-170"><a href="data-preparation.html#cb18-170" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb18-171"><a href="data-preparation.html#cb18-171" tabindex="-1"></a>        ,<span class="st">&quot; trees)&quot;</span></span>
<span id="cb18-172"><a href="data-preparation.html#cb18-172" tabindex="-1"></a>      )</span>
<span id="cb18-173"><a href="data-preparation.html#cb18-173" tabindex="-1"></a>      , <span class="at">range =</span> <span class="fu">paste0</span>(min, <span class="st">&quot;—&quot;</span>, max)</span>
<span id="cb18-174"><a href="data-preparation.html#cb18-174" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-175"><a href="data-preparation.html#cb18-175" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>( unit_name, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-176"><a href="data-preparation.html#cb18-176" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(unit_name,n,min,max)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-177"><a href="data-preparation.html#cb18-177" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">relocate</span>(unit_lab) <span class="sc">%&gt;%</span> </span>
<span id="cb18-178"><a href="data-preparation.html#cb18-178" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb18-179"><a href="data-preparation.html#cb18-179" tabindex="-1"></a>      <span class="at">metric =</span> <span class="fu">factor</span>(</span>
<span id="cb18-180"><a href="data-preparation.html#cb18-180" tabindex="-1"></a>        metric</span>
<span id="cb18-181"><a href="data-preparation.html#cb18-181" tabindex="-1"></a>        , <span class="at">ordered =</span> T</span>
<span id="cb18-182"><a href="data-preparation.html#cb18-182" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb18-183"><a href="data-preparation.html#cb18-183" tabindex="-1"></a>            <span class="st">&quot;tree_height_m&quot;</span></span>
<span id="cb18-184"><a href="data-preparation.html#cb18-184" tabindex="-1"></a>            , <span class="st">&quot;dbh_cm&quot;</span></span>
<span id="cb18-185"><a href="data-preparation.html#cb18-185" tabindex="-1"></a>            , <span class="st">&quot;tree_cbh_m&quot;</span></span>
<span id="cb18-186"><a href="data-preparation.html#cb18-186" tabindex="-1"></a>            , <span class="st">&quot;max_crown_diam_height_m&quot;</span></span>
<span id="cb18-187"><a href="data-preparation.html#cb18-187" tabindex="-1"></a>            , <span class="st">&quot;cruz_tree_kg_per_m3&quot;</span></span>
<span id="cb18-188"><a href="data-preparation.html#cb18-188" tabindex="-1"></a>            , <span class="st">&quot;landfire_tree_kg_per_m3&quot;</span></span>
<span id="cb18-189"><a href="data-preparation.html#cb18-189" tabindex="-1"></a>          )</span>
<span id="cb18-190"><a href="data-preparation.html#cb18-190" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb18-191"><a href="data-preparation.html#cb18-191" tabindex="-1"></a>            <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb18-192"><a href="data-preparation.html#cb18-192" tabindex="-1"></a>            , <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb18-193"><a href="data-preparation.html#cb18-193" tabindex="-1"></a>            , <span class="st">&quot;Crown Base Ht. (m)&quot;</span></span>
<span id="cb18-194"><a href="data-preparation.html#cb18-194" tabindex="-1"></a>            , <span class="st">&quot;HMD (m)&quot;</span></span>
<span id="cb18-195"><a href="data-preparation.html#cb18-195" tabindex="-1"></a>            , <span class="st">&quot;Cruz CBD&lt;br&gt;kg m&lt;sup&gt;-3&lt;/sup&gt;&quot;</span></span>
<span id="cb18-196"><a href="data-preparation.html#cb18-196" tabindex="-1"></a>            , <span class="st">&quot;LANDFIRE CBD&lt;br&gt;kg m&lt;sup&gt;-3&lt;/sup&gt;&quot;</span></span>
<span id="cb18-197"><a href="data-preparation.html#cb18-197" tabindex="-1"></a>          )</span>
<span id="cb18-198"><a href="data-preparation.html#cb18-198" tabindex="-1"></a>      )</span>
<span id="cb18-199"><a href="data-preparation.html#cb18-199" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-200"><a href="data-preparation.html#cb18-200" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb18-201"><a href="data-preparation.html#cb18-201" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Summary statistics for selected metrics&quot;</span></span>
<span id="cb18-202"><a href="data-preparation.html#cb18-202" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb18-203"><a href="data-preparation.html#cb18-203" tabindex="-1"></a>        <span class="st">&quot;Unit Name&quot;</span>, <span class="st">&quot;Metric&quot;</span></span>
<span id="cb18-204"><a href="data-preparation.html#cb18-204" tabindex="-1"></a>        , <span class="st">&quot;Mean&quot;</span>, <span class="st">&quot;Median&quot;</span></span>
<span id="cb18-205"><a href="data-preparation.html#cb18-205" tabindex="-1"></a>        , <span class="st">&quot;Std Dev&quot;</span>, <span class="st">&quot;Range&quot;</span></span>
<span id="cb18-206"><a href="data-preparation.html#cb18-206" tabindex="-1"></a>      )</span>
<span id="cb18-207"><a href="data-preparation.html#cb18-207" tabindex="-1"></a>      , <span class="at">escape =</span> F</span>
<span id="cb18-208"><a href="data-preparation.html#cb18-208" tabindex="-1"></a>      <span class="co"># , digits = 2</span></span>
<span id="cb18-209"><a href="data-preparation.html#cb18-209" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-210"><a href="data-preparation.html#cb18-210" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-211"><a href="data-preparation.html#cb18-211" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb18-212"><a href="data-preparation.html#cb18-212" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sycan-marsh-or.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
